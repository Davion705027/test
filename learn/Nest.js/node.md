# egg

- 多环境配置，作为企业应用，我们会有多个环境——测试环境、stage环境、生产环境，每个环境下的应用所连接底层服务的参数、配置信息都是不一样的。EggJS可以通过启动时注入环境变量来加载不同的配置文件，并且挂在到context上，应用代码根本不用关心环境的差异，多环境问题轻松解决。
- 系统稳定性，使用Express和Koa的话，为了系统稳定性，必须用PM2来做进程管理和监控，而这又加大了运维和部署的复杂度，但是EggJS天然具备进程管理和监控功能
- 定时任务，Egg自身带有schedule模块的，你不需要再引入第三方插件。

# 系统稳定性需要关注的几点：
- 多实例+多进程：一个进程"倒下"了，立即拉起一个新的进程并关闭异常进程，保证一直有健康正常的进程来响应前端请求。
本次项目是2个实例，每个实例16个进程。
- 平滑重启+自动扩容： 应用部署新版本时不应该是让服务变得不可用，哪怕是一秒钟，所以需要通过多实例交替重启来实现"平滑重启"
我们公司云平台的做法是 ：先删除一个实例pod，再拉起一个新的pod，等新pod的存活检查和就绪检查都通过后，再删除一个……这样循环，从而实现平滑重启
自动扩容是当你的应用突然迎来一波流量高峰，云平台可以自动为你复制出多个pod，你只需要设置满足扩容的条件即可（如CPU使用率超过85%并持续1分钟）
- 异常监控：代码如果出现抛出异常，应该第一时间得知，化被动为主动。（代码抛异常，有时并不会让系统崩溃，所以很容易被人忽视）。
本次项目使用了Sentry，如果发生错误，开发者会第一时间收到邮件通知，并且可以在平台中看到各个异常相关的数据和统计。
- 指标监控：对于应用运行状态和指标的监控也是十分重要，如CPU使用率、内存使用率、流量等等，可以自定义指标，如QPS、错误累计数、文件句柄数等等。
本次项目使用了Prometheus来监控。
在Prometheus的下游，我们公司还提供了Grafana——进行指标可视化，和报警平台——通过PromQL来对关注指标进行报警，报警方式还很多，包括：邮件 => 社交软件 => 发送短信 => 拨打电话（一旦出了异常，报警是躲不掉的）
- 日志收集 egg自带

# egg vs nest
- 装饰器 路由去中心化

# 消息队列
1. 客户端上报数据到消息队列：客户端将数据发送到消息队列，而不是直接发送到服务器。你可以为客户端提供一个接口或者 SDK，用来将数据发送到消息队列中。
2. 服务器消费消息队列中的数据：服务器端通过订阅消息队列，异步地从队列中取出数据进行处理和存储。可以使用 Egg.js 的异步任务或者定时任务来实现消息队列的消费者。
3. 监控和调优：使用消息队列后，你需要监控消息队列的状态和服务器的性能，及时调整系统的配置和资源，确保系统的稳定性和性能。





# vite
- es module 请求直接下载
- 预构建
但是 node_modules 下的文件有的包是 commonjs 的，并且可能有很多个模块，这时 vite 做了预构建也叫 deps optimize。
它用 esbuild 分析依赖，然后用 esbuild 打包成 esm 的包之后输出到 node_modules/.vite 下，并生成了一个 metadata.json 来记录 hash。
浏览器里用 max-age 强缓存这些预打包的模块，但是带了 hash 的query。这样当重新 build 的时候，可以通过修改 query 来触发更新。

# redis
mysql数据库通过硬盘存储信息  redis-cli