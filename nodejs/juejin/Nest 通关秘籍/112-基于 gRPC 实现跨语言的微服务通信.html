<header>
        <style>
            .markdown-body{
                width: 80%;
                margin: auto;
            }
            .code-block-extension-header{
                display: none;
            }
        </style>
    </header><div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>后端系统大多都是微服务的架构，而且还可能同时有多种语言实现的微服务，比如 java、go、python、c++、node 等。</p>
<p>那么问题来了，多种语言实现的微服务之间如何通信呢？</p>
<p>有的同学会说 http 不就行？</p>
<p>但 http 是文本传输，通信效率低。更重要的是这些微服务并不会提供 http 接口，因为它们又不是直接面向客户端的。</p>
<p>跨语言调用服务一般会用 gRPC，它是 google 出的一种跨语言的远程方法调用的方案。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8744e0820c3b4e55bb58cbf2d4224dec~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=764&amp;h=250&amp;s=13642&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>其中，RPC 是 Remote Procedure Call，远程过程调用。</p>
<p>比如 java 微服务有个方法 aaa，node 微服务想调用它，就可以通过 gRPC 来实现。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/960c5ba9f121468489a373ba8df71872~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=802&amp;h=344&amp;s=16534&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这节我们就来用一下 gRPC。</p>
<p>当然，我们不会真的创建 java 的微服务，而是会用两个 nest 的微服务之间实现 gRPC 通信。</p>
<p>在 java、phthon、go 等语言的微服务里，接入 gRPC 都是类似的。</p>
<p>我们创建个 nest 项目：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">arduino</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-arduino code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">nest <span class="hljs-keyword">new</span> grpc-client</span>
</code></pre>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/465121afc9454f7987fdba406856e69c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=828&amp;h=674&amp;s=255412&amp;e=png&amp;b=010101" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>我们用 monorepo 的形式来放 client 和 server 的代码。</p>
<p>执行：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">vbscript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-vbscript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">nest g app grpc-<span class="hljs-built_in">server</span></span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93202f1629dc4df093718fbe7e14b23b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1032&amp;h=630&amp;s=173185&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这样，就有了两个 nest 的 application：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7a0baac2ec35411eb79810b56e45a47b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=372&amp;h=280&amp;s=21852&amp;e=png&amp;b=1c1c1c" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>改下 grpc-server 的启动端口号为 3001:</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b4e9eb098344ce4b9f9232baa9cdb76~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1090&amp;h=520&amp;s=117192&amp;e=png&amp;b=1c1c1c" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>分别把两个 nest 应用跑起来：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">arduino</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-arduino code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm run start:dev grpc-client</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">npm run start:dev grpc-server</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd8725a610614134afcced48055da1d1~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=900&amp;h=468&amp;s=107964&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/889173b7f3cc4bec81783fba5d343191~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=906&amp;h=456&amp;s=105741&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>浏览器访问下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e716b0a98d24a8fa3e62afc3ff4eb61~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=570&amp;h=198&amp;s=16375&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3c63728610e4df2aa29e20643bf1e57~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=502&amp;h=178&amp;s=15931&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这就代表两个 nest 应用都跑起来了。</p>
<p>然后我们把 grpc-server 改造成 grpc 的微服务。</p>
<p>安装用到的微服务的包：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install <span class="hljs-attr">--save</span> <span class="hljs-keyword">@nestjs</span>/microservices</span>
</code></pre>
<p>grpc 的包：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">scss</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-scss code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install <span class="hljs-attr">--save</span> <span class="hljs-keyword">@grpc</span>/grpc-js <span class="hljs-keyword">@grpc</span>/proto-loader</span>
</code></pre>
<p>修改下 grpc-server 的 main.ts</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NestFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GrpcOptions</span>, <span class="hljs-title class_">Transport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/microservices'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GrpcServerModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./grpc-server.module'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="4"><span class="hljs-keyword">import</span> { join } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="5"></span>
<span class="code-block-extension-codeLine" data-line-num="6"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="7">  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-property">createMicroservice</span>&lt;<span class="hljs-title class_">GrpcOptions</span>&gt;(<span class="hljs-title class_">GrpcServerModule</span>, {</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">transport</span>: <span class="hljs-title class_">Transport</span>.<span class="hljs-property">GRPC</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-attr">options</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="10">      <span class="hljs-attr">url</span>: <span class="hljs-string">'localhost:8888'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="11">      <span class="hljs-attr">package</span>: <span class="hljs-string">'book'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="12">      <span class="hljs-attr">protoPath</span>: <span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'book/book.proto'</span>),</span>
<span class="code-block-extension-codeLine" data-line-num="13">    },</span>
<span class="code-block-extension-codeLine" data-line-num="14">  });</span>
<span class="code-block-extension-codeLine" data-line-num="15"></span>
<span class="code-block-extension-codeLine" data-line-num="16">  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="17">}</span>
<span class="code-block-extension-codeLine" data-line-num="18"><span class="hljs-title function_">bootstrap</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="19"></span>
</code></pre>
<p>和我们前面创建微服务的方式一样，只不过传输方式 transport 改为 GRPC，然后指定微服务监听端口为 8888。</p>
<p>然后在 options 指定 protoPath。</p>
<p>在 src 下创建这个对应的文件：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbcc2da7c11a4e119577af90d2bf6b63~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1360&amp;h=696&amp;s=148820&amp;e=png&amp;b=1d1d1d" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">syntax = <span class="hljs-string">"proto3"</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3">package book;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">service <span class="hljs-title class_">BookService</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  rpc <span class="hljs-title class_">FindBook</span> (<span class="hljs-title class_">BookById</span>) returns (<span class="hljs-title class_">Book</span>) {}</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
<span class="code-block-extension-codeLine" data-line-num="8"></span>
<span class="code-block-extension-codeLine" data-line-num="9">message <span class="hljs-title class_">BookById</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="10">  int32 id = <span class="hljs-number">1</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
<span class="code-block-extension-codeLine" data-line-num="12"></span>
<span class="code-block-extension-codeLine" data-line-num="13">message <span class="hljs-title class_">Book</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="14">  int32 id = <span class="hljs-number">1</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="15">  string name = <span class="hljs-number">2</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="16">  string desc = <span class="hljs-number">3</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="17">}</span>
</code></pre>
<p>这是一种叫做 protocol buffer 的语法。</p>
<p>我们安装个语法高亮插件</p>
<p>搜索 ext:proto，也就是处理 .proto 文件的插件：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1bb01f9717a4d9d99cd4f3ba088714e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=742&amp;h=256&amp;s=33645&amp;e=png&amp;b=37373c" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>安装之后就有语法高亮了：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5685d36ce8794e9aa692c51d6d42262e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=792&amp;h=672&amp;s=84683&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>为什么要有一种 protocol buffer 的语法呢？</p>
<p>因为要跨语言通信，不同语言的语法又不一样，那怎么通信呢？</p>
<p>定义一种用于通信的语言，各种语言都支持这种语法的解析不就行了？</p>
<p>这就是为什么会有 protocol buffer。</p>
<p>这些语法也很容易看懂：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-attr">syntax</span> = <span class="hljs-string">"proto3"</span></span>
</code></pre>
<p>是使用 proto3 版本的语法。</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">go</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-go code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">package</span> book;</span>
</code></pre>
<p>是当前包为 book，也就是一种命名空间。</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">scss</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-scss code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">service BookService {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  rpc FindBook (BookById) returns (Book) {}</span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
</code></pre>
<p>这个就是定义当前服务可以远程调用的方法。</p>
<p>有一个 FindBook 方法，参数是 BookById，返回值是 Book</p>
<p>然后下面就是参数和返回值的消息格式：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">message BookById {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  int32 <span class="hljs-attr">id</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">message Book {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  int32 <span class="hljs-attr">id</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span></span>
<span class="code-block-extension-codeLine" data-line-num="7">  string <span class="hljs-attr">name</span> = <span class="hljs-number">2</span><span class="hljs-comment">;</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">  string <span class="hljs-attr">desc</span> = <span class="hljs-number">3</span><span class="hljs-comment">;</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>
<p>book.proto 只是定义了可用的方法和参数返回值的格式，我们还要在 controller 里实现对应的方法：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f4eb5d734494e2fbb8f8f925bf75afb~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1130&amp;h=846&amp;s=198478&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">GrpcMethod</span>(<span class="hljs-string">'BookService'</span>, <span class="hljs-string">'FindBook'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-title function_">findBook</span>(<span class="hljs-params">data: { id: number}</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-keyword">const</span> items = [</span>
<span class="code-block-extension-codeLine" data-line-num="4">      { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'前端调试通关秘籍'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'网页和 node 调试'</span> },</span>
<span class="code-block-extension-codeLine" data-line-num="5">      { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Nest 通关秘籍'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'Nest 和各种后端中间件'</span> },</span>
<span class="code-block-extension-codeLine" data-line-num="6">    ];</span>
<span class="code-block-extension-codeLine" data-line-num="7">    <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">{ id }</span>) =&gt;</span> id === data.<span class="hljs-property">id</span>);</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>
<p>实现了 findBook 方法，并通过 @GrpcMethod 把它标识为  grpc 的远程调用的方法。</p>
<p>在 nest-cli.json 添加 assets 配置，让 nest 在 build 的时候把 proto 也复制到 dist 目录下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86284c6f816c471eb4c0525c39b55109~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=768&amp;h=360&amp;s=75026&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-string">"assets"</span>: [<span class="hljs-string">"**/*.proto"</span>],</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-string">"watchAssets"</span>: <span class="hljs-literal">true</span>,</span>
</code></pre>
<p>把它跑起来：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">arduino</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-arduino code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm run start:dev grpc-server</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b87cbb5bb2f412297747c7af07bb251~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1100&amp;h=422&amp;s=90536&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这时 dist 下就有 grpc-server 的代码了：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f832c59003d4510aed6ba309f9323e6~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=422&amp;h=276&amp;s=22634&amp;e=png&amp;b=1d1d1d" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后我们在 grpc-client 里连上它：</p>
<p>在 AppModule 里添加连接 grpc-server 的微服务的配置：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12030bd8ae8a4c6c85d26214392c64fe~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1092&amp;h=928&amp;s=177452&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.controller'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="4"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ClientsModule</span>, <span class="hljs-title class_">Transport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/microservices'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="5"><span class="hljs-keyword">import</span> { join } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">@<span class="hljs-title class_">Module</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="8">  <span class="hljs-attr">imports</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-title class_">ClientsModule</span>.<span class="hljs-title function_">register</span>([</span>
<span class="code-block-extension-codeLine" data-line-num="10">      {</span>
<span class="code-block-extension-codeLine" data-line-num="11">        <span class="hljs-attr">name</span>: <span class="hljs-string">'BOOK_PACKAGE'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="12">        <span class="hljs-attr">transport</span>: <span class="hljs-title class_">Transport</span>.<span class="hljs-property">GRPC</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="13">        <span class="hljs-attr">options</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="14">          <span class="hljs-attr">url</span>: <span class="hljs-string">'localhost:8888'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="15">          <span class="hljs-attr">package</span>: <span class="hljs-string">'book'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="16">          <span class="hljs-attr">protoPath</span>: <span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'book/book.proto'</span>),</span>
<span class="code-block-extension-codeLine" data-line-num="17">        },</span>
<span class="code-block-extension-codeLine" data-line-num="18">      },</span>
<span class="code-block-extension-codeLine" data-line-num="19">    ]),</span>
<span class="code-block-extension-codeLine" data-line-num="20">  ],</span>
<span class="code-block-extension-codeLine" data-line-num="21">  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],</span>
<span class="code-block-extension-codeLine" data-line-num="22">  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],</span>
<span class="code-block-extension-codeLine" data-line-num="23">})</span>
<span class="code-block-extension-codeLine" data-line-num="24"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}</span>
</code></pre>
<p>同样，客户端也是需要 proto 文件的，不然不知道怎么解析协议数据。</p>
<p>把 book/book.proto 文件复制过来：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3dc9c2b83b6487fa8b37afc7d9ea527~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=442&amp;h=364&amp;s=36430&amp;e=png&amp;b=1b1b1b" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后在 AppController 里实现调用远程方法的逻辑：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31a3a5b082d44a289f748f9e7a7c83e8~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1160&amp;h=1224&amp;s=211307&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>注入 BOOK_PACKAGE 的 grpc 客户端对象。</p>
<p>在 onModuleInit 的时候调用 getService 方法，拿到 BookService 的实例。</p>
<p>然后调用它的 findBook 方法。</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">Inject</span>, <span class="hljs-title class_">Param</span>, <span class="hljs-title class_">Query</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ClientGrpc</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/microservices'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">interface <span class="hljs-title class_">FindById</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  <span class="hljs-attr">id</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
<span class="code-block-extension-codeLine" data-line-num="8">interface <span class="hljs-title class_">Book</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="9">  <span class="hljs-attr">id</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="10">  <span class="hljs-attr">name</span>: string;</span>
<span class="code-block-extension-codeLine" data-line-num="11">  <span class="hljs-attr">desc</span>: string;  </span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
<span class="code-block-extension-codeLine" data-line-num="13">interface <span class="hljs-title class_">BookService</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="14">  <span class="hljs-title function_">findBook</span>(<span class="hljs-attr">param</span>: <span class="hljs-title class_">FindById</span>): <span class="hljs-title class_">Book</span> </span>
<span class="code-block-extension-codeLine" data-line-num="15">}</span>
<span class="code-block-extension-codeLine" data-line-num="16">@<span class="hljs-title class_">Controller</span>()</span>
<span class="code-block-extension-codeLine" data-line-num="17"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppController</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="18">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private readonly appService: AppService</span>) {}</span>
<span class="code-block-extension-codeLine" data-line-num="19"></span>
<span class="code-block-extension-codeLine" data-line-num="20">  @<span class="hljs-title class_">Inject</span>(<span class="hljs-string">'BOOK_PACKAGE'</span>) </span>
<span class="code-block-extension-codeLine" data-line-num="21">  private <span class="hljs-attr">client</span>: <span class="hljs-title class_">ClientGrpc</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="22"></span>
<span class="code-block-extension-codeLine" data-line-num="23">  private <span class="hljs-attr">bookService</span>: <span class="hljs-title class_">BookService</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="24"></span>
<span class="code-block-extension-codeLine" data-line-num="25">  <span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="26">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bookService</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">getService</span>(<span class="hljs-string">'BookService'</span>);</span>
<span class="code-block-extension-codeLine" data-line-num="27">  }</span>
<span class="code-block-extension-codeLine" data-line-num="28"></span>
<span class="code-block-extension-codeLine" data-line-num="29">  @<span class="hljs-title class_">Get</span>(<span class="hljs-string">'book/:id'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="30">  <span class="hljs-title function_">getHero</span>(<span class="hljs-params">@Param(<span class="hljs-string">'id'</span>) id: number</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="31">    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bookService</span>.<span class="hljs-title function_">findBook</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="32">      id</span>
<span class="code-block-extension-codeLine" data-line-num="33">    });</span>
<span class="code-block-extension-codeLine" data-line-num="34">  }</span>
<span class="code-block-extension-codeLine" data-line-num="35">}</span>
</code></pre>
<p>把它跑起来：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">arduino</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-arduino code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm run start:dev grpc-client</span>
</code></pre>
<p>浏览器访问下：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2be16550f9a54a1fa884bf1c32b0d716~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=848&amp;h=204&amp;s=28571&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/119e9a214c244c2ab5c00636c21224e1~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=890&amp;h=182&amp;s=28557&amp;e=png&amp;b=fefefe" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>可以看到，远程方法调用成功了。</p>
<p>这就是基于 grpc 的远程方法调用，用 java、python、go、c++ 等实现的微服务也是这样来通信。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82cd368ae0fb4321a55b01182ff5e08a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=998&amp;h=472&amp;s=31177&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>通过 protocol buffer 的语法定义通信数据的格式，比如 package、service 等。</p>
<p>然后 server 端实现 service 对应的方法，client 端远程调用这个 service。</p>
<p>比如在 java 的 srping 里，需要安装这两个依赖：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95ac4d74e3984ac7bce3ed1e5bdfe21b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1256&amp;h=252&amp;s=60129&amp;e=png&amp;b=f4f6fa" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后也是定义这样的 proto 文件：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f27f966938ae4fb798eef7b9a54acc60~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1168&amp;h=1030&amp;s=172873&amp;e=png&amp;b=f4f6fa" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>之后定义对应的 servie：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f34e2518db424f65af445e2dfda82e32~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1596&amp;h=942&amp;s=190072&amp;e=png&amp;b=f3f5f9" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>和 node 里差不多。</p>
<p>这样就能跨语言调用对方的方法了。</p>
<p>案例代码在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuarkGluonPlasma%2Fnestjs-course-code%2Ftree%2Fmain%2Fgrpc-client" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/grpc-client" ref="nofollow noopener noreferrer">小册仓库</a></p>
<h2 data-id="heading-0">总结</h2>
<p>这节我们学习了基于 gRPC 的远程方法调用。</p>
<p>不同语言的微服务之间可以基于 gRPC 来相互调用对方的方法。</p>
<p>它的实现方式是通过 protocol buffer 的语法来定义通信数据的格式，定义 package、service。</p>
<p>然后 server 端实现 service 对应的方法，client 端远程调用这些 service。</p>
<p>这样就可以实现在 java、node、go、python 等多种语言之间实现微服务的远程方法调用。</p></div>