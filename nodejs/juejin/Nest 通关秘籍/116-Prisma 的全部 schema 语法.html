<header>
        <style>
            .markdown-body{
                width: 80%;
                margin: auto;
            }
            .code-block-extension-header{
                display: none;
            }
        </style>
    </header><div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这节我们来学习下 Prisma 的 schema 文件的全部语法。</p>
<p>先创建个新项目：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-built_in">mkdir</span> prisma-schema</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-built_in">cd</span> prisma-schema</span>
<span class="code-block-extension-codeLine" data-line-num="3">npm init -y</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ce378d3a0884d45b88594b7f9b755e7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=846&amp;h=684&amp;s=112366&amp;e=png&amp;b=000000" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>全局安装 prisma：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang"></span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install -g prisma</span>
</code></pre>
<p>然后进入项目，执行 init 命令：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">csharp</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-csharp code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">prisma <span class="hljs-keyword">init</span></span>
</code></pre>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98e11c3aca8c492b81ab65cf2b2be480~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1028&amp;h=388&amp;s=76003&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>生成了 .env 和 schema 文件：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e65daf9ecb0449188bead9663fa77fa~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=450&amp;h=190&amp;s=23342&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后改下 .env 文件的数据库连接信息：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9260844466e7496fa11bdf18a5da4e14~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1026&amp;h=348&amp;s=134798&amp;e=png&amp;b=202020" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-attr">DATABASE_URL</span>=<span class="hljs-string">"mysql://root:guang@localhost:3306/prisma_test"</span></span>
</code></pre>
<p>改一下 db 的 provider 为 mysql，并且添加一个 model</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da4a29a7dca24d628b3f49c672d8a3c0~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=864&amp;h=614&amp;s=156250&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">prisma</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-prisma code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">generator client {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  provider = "prisma-client-js"</span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">datasource db {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  provider = "mysql"</span>
<span class="code-block-extension-codeLine" data-line-num="7">  url      = env("DATABASE_URL")</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">model User {</span>
<span class="code-block-extension-codeLine" data-line-num="11">  id    Int     @id @default(autoincrement())</span>
<span class="code-block-extension-codeLine" data-line-num="12">  email String  @unique</span>
<span class="code-block-extension-codeLine" data-line-num="13">  name  String?</span>
<span class="code-block-extension-codeLine" data-line-num="14">}</span>
</code></pre>
<p>然后执行 generate 命令：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang"></span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">prisma generate</span>
</code></pre>
<p>会在 node_modules/@prisma/client 下生成客户端代码：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe2a4e7c9037465a8cb777084a753931~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1112&amp;h=982&amp;s=366163&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这个生成位置是可以改的：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/970e707c2b90430cadb65db290aceca6~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=826&amp;h=608&amp;s=153883&amp;e=png&amp;b=202020" alt="" loading="lazy" class="medium-zoom-image">
在 generator 指定 output 的位置即可：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">generator client {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  <span class="hljs-attr">provider</span> = <span class="hljs-string">"prisma-client-js"</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">  <span class="hljs-attr">output</span>   = <span class="hljs-string">"../generated/client"</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>
<p>然后再次 generate：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang"></span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">prisma generate</span>
</code></pre>
<p>这时候就是在根目录生成的代码：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19db6a24c35c482695d1f2b57668b1e7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1074&amp;h=534&amp;s=219731&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5260ed1620f4131823674ed431e54b9~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=546&amp;h=502&amp;s=108401&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>此外，generator 除了可以生成 client 代码外，还可以生成别的东西。</p>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.prisma.io%2Fdocs%2Fconcepts%2Fcomponents%2Fprisma-schema%2Fgenerators%23community-generators" target="_blank" rel="nofollow noopener noreferrer" title="https://www.prisma.io/docs/concepts/components/prisma-schema/generators#community-generators" ref="nofollow noopener noreferrer">文档</a>里可以看到有很多社区的 generator：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/787f61d8fd7b434abd7d537640ba24f4~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1462&amp;h=1160&amp;s=637326&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>我们试一下这个 json 和 docs 的 generator：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install <span class="hljs-attr">--save-dev</span> prisma-docs-generator</span>
<span class="code-block-extension-codeLine" data-line-num="2">npm install <span class="hljs-attr">--save-dev</span> prisma-json-schema-generator</span>
</code></pre>
<p>先安装相关的包。</p>
<p>然后在 schema 文件里配置 3 个 generator：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ccca2d497f44f6080fc60ab88abbe2f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=982&amp;h=704&amp;s=222270&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">generator client {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  <span class="hljs-attr">provider</span> = <span class="hljs-string">"prisma-client-js"</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">  <span class="hljs-attr">output</span>   = <span class="hljs-string">"../generated/client"</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
<span class="code-block-extension-codeLine" data-line-num="5"></span>
<span class="code-block-extension-codeLine" data-line-num="6">generator docs {</span>
<span class="code-block-extension-codeLine" data-line-num="7">  <span class="hljs-attr">provider</span> = <span class="hljs-string">"node node_modules/prisma-docs-generator"</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">  <span class="hljs-attr">output</span>   = <span class="hljs-string">"../generated/docs"</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
<span class="code-block-extension-codeLine" data-line-num="10"></span>
<span class="code-block-extension-codeLine" data-line-num="11">generator json {</span>
<span class="code-block-extension-codeLine" data-line-num="12">  <span class="hljs-attr">provider</span> = <span class="hljs-string">"prisma-json-schema-generator"</span></span>
<span class="code-block-extension-codeLine" data-line-num="13">  <span class="hljs-attr">output</span>   = <span class="hljs-string">"../generated/json"</span></span>
<span class="code-block-extension-codeLine" data-line-num="14">}</span>
</code></pre>
<p>把 generated 目录删掉，重新生成：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang"></span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma generate</span>
</code></pre>
<p>注意，这里要用 npx 执行，因为如果是执行全局命令，会找不到项目目录下安装的 generator。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa75aab2da764e06afb755efcfdbcc76~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1126&amp;h=434&amp;s=132905&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>提示三个 generator 的产物都输出到了对应目录。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cc2dd16688944645a86dbaf44ff472c3~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=530&amp;h=784&amp;s=156876&amp;e=png&amp;b=1a1a1a" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>json schema 的 generator 会把 schema 文件转为 json 版：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26eebdf46e0e42488aa26a8264e32852~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1000&amp;h=1086&amp;s=239381&amp;e=png&amp;b=202020" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>而 docs 则是会生成文档。</p>
<p>我们跑起来看看：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx http-server ./generated/docs</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f86f5187be6f432f93cee71b6944c60e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=738&amp;h=504&amp;s=160384&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>文档里会列出 model 的所有字段：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1cb3242310e140a081abdf4150f9f92e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=2234&amp;h=1452&amp;s=652927&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>还有它的所有 CRUD 方法，每个方法的参数的类型等：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebe58ed1227049ab85480e363d699665~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=2010&amp;h=1432&amp;s=794617&amp;e=gif&amp;f=34&amp;b=fdfdfd" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>当你想做 crud 的时候，查下这个生成的文档，特别方便。</p>
<p>datasource 部分是配置数据库连接信息的。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/956a4ec06c1c47ffb25fd73e94b6597c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=534&amp;h=332&amp;s=80610&amp;e=png&amp;b=212121" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>provider 里指定连接的数据库的类型。</p>
<p>url 部分是连接的 url，也就是这个</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a34f5e5f8fbe435e9e56d752a0712f56~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=998&amp;h=350&amp;s=131006&amp;e=png&amp;b=202020" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>在 schema 文件里可以用这种方式读取某个 env 的变量：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/590c12df2c1049f5a3c4bd989a277644~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=546&amp;h=170&amp;s=37601&amp;e=png&amp;b=20201f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>接下来是 model 部分。</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">java</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-java code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model User {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id    Int     <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement())</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">  email String  <span class="hljs-meta">@unique</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">  name  String?</span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
</code></pre>
<p>这部分很容易看懂，第一列是字段名，第二列是类型，第三列是一些其他信息。</p>
<p>首先重置一下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">perl</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-perl code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">prisma migrate <span class="hljs-keyword">reset</span></span>
</code></pre>
<p>我们用 migrate 命令生成 sql：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">prisma migrate dev <span class="hljs-attr">--name</span> aaa</span>
</code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c7c9139f6fb4d8688a63570124746eb~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1088&amp;h=394&amp;s=74750&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后创建一个 aaa 的迁移：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31c33f3190734ff796f7f87778a76a0a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1116&amp;h=532&amp;s=94200&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>它会创建对应的 sql 文件并执行：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69a09ceaea3a4033925c65d16075d0e2~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1592&amp;h=566&amp;s=157901&amp;e=png&amp;b=1d1d1d" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1d5139def864805aa3819bfa306327b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1078&amp;h=510&amp;s=155241&amp;e=png&amp;b=eeebea" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>可以看到 model 的声明和生成的 sql 的对应关系：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">java</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-java code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model User {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id    Int     <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement())</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">  email String  <span class="hljs-meta">@unique</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">  name  String?</span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
</code></pre>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72306bed7f66413bba5662cf722c3788~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=978&amp;h=408&amp;s=74795&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>String 默认是 VARCHAR(191)</p>
<p>@id 会创建主键约束，@default 是默认值，而 autoincrement 是自增。</p>
<p>@unique 会创建唯一约束。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41761dfd06284b7c88896639a000223f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=910&amp;h=356&amp;s=63744&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>我们再创建一个 model</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6439250bb3b342c78f3fde126bb3512e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=774&amp;h=600&amp;s=103672&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">kotlin</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-kotlin code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model Test {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id <span class="hljs-built_in">Int</span> <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement()</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="3">  aaa String <span class="hljs-meta">@db</span>.Text</span>
<span class="code-block-extension-codeLine" data-line-num="4">  bbb <span class="hljs-built_in">Int</span> <span class="hljs-meta">@db</span>.TinyInt <span class="hljs-meta">@map(<span class="hljs-string">"bbb2"</span>)</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">  ccc String <span class="hljs-meta">@db</span>.VarChar(<span class="hljs-number">50</span>) <span class="hljs-meta">@unique</span></span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">  @<span class="hljs-meta">@map(<span class="hljs-string">"test_test"</span>)</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">  @<span class="hljs-meta">@index([bbb, ccc])</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>
<p>这是 @db.xxx 可以指定具体的 mysql 的数据类型，有括号的是可以填入参数的，比如 VARCHAR 可以指定长度：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3cc27fa1b618406e8be88f49d27b273b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=624&amp;h=420&amp;s=66052&amp;e=png&amp;b=212121" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5565b81d774416aa627a46bf9ed4cf6~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=656&amp;h=500&amp;s=71951&amp;e=png&amp;b=212121" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>@map 是给字段指定另一个名字，@@map 是给表指定另一个名字。</p>
<p>而 @@index 则是创建一个索引，这里创建了 bbb、ccc 的联合索引。</p>
<p>索引就像书的目录一样，可以加快 sql 查询速度，sql 优化的时候我们经常会把高频查询的字段创建索引。</p>
<p>我们测试下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma migrate dev <span class="hljs-attr">--name</span> bbb</span>
</code></pre>
<p>创建 bbb 的数据库迁移。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cf66119beba491296863bc5f62d3b0a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=972&amp;h=626&amp;s=93174&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image">
生成的 sql 如下：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67009848e9514836bbd28a370303b398~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1542&amp;h=568&amp;s=162390&amp;e=png&amp;b=1d1d1d" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>对比下 model 语法和生成的 sql：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">kotlin</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-kotlin code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model Test {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id <span class="hljs-built_in">Int</span> <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement()</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="3">  aaa String <span class="hljs-meta">@db</span>.Text</span>
<span class="code-block-extension-codeLine" data-line-num="4">  bbb <span class="hljs-built_in">Int</span> <span class="hljs-meta">@db</span>.TinyInt <span class="hljs-meta">@map(<span class="hljs-string">"bbb2"</span>)</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">  ccc String <span class="hljs-meta">@db</span>.VarChar(<span class="hljs-number">50</span>) <span class="hljs-meta">@unique</span></span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">  @<span class="hljs-meta">@map(<span class="hljs-string">"test_test"</span>)</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">  @<span class="hljs-meta">@index([bbb, ccc])</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a7637b5e4494d77bdf57266f38a4437~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1048&amp;h=550&amp;s=108446&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>可以看到 @db.xxx、@map、@@map、@@index 都生效了</p>
<p>在 mysql workbench 里也可以看到这个表：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec84339120ce48bbb19f9bdf2155b9a7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1134&amp;h=598&amp;s=188194&amp;e=png&amp;b=edeae9" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>那表和表之间的一对多、多对多关系呢？</p>
<p>我们再添加几个 model：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78ba0d7c18f84d65992e8ead9f396980~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1392&amp;h=904&amp;s=194900&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">java</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-java code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model Department {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id        Int    <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement())</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">  name      String  <span class="hljs-meta">@db</span>.VarChar(<span class="hljs-number">20</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="4">  createTime DateTime <span class="hljs-meta">@default(now())</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">  updateTime DateTime <span class="hljs-meta">@updatedAt</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">  employees     Employee[]</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
<span class="code-block-extension-codeLine" data-line-num="8"></span>
<span class="code-block-extension-codeLine" data-line-num="9">model Employee {</span>
<span class="code-block-extension-codeLine" data-line-num="10">  id         Int       <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement())</span></span>
<span class="code-block-extension-codeLine" data-line-num="11">  name      String     <span class="hljs-meta">@db</span>.VarChar(<span class="hljs-number">20</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="12">  phone     String     <span class="hljs-meta">@db</span>.VarChar(<span class="hljs-number">30</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="13"></span>
<span class="code-block-extension-codeLine" data-line-num="14">  deaprtmentId Int</span>
<span class="code-block-extension-codeLine" data-line-num="15">  department     Department      <span class="hljs-meta">@relation(fields: [deaprtmentId], references: [id])</span></span>
<span class="code-block-extension-codeLine" data-line-num="16">}</span>
</code></pre>
<p>这里用到了几个新语法：</p>
<p>创建时间我们使用 @default(now()) 的方式指定，这样插入数据的时候会自动填入当前时间。</p>
<p>更新时间使用 @updatedAt，会自动设置当前时间。</p>
<p>员工和部门是多对一关系，在员工那一侧添加一个 departmentId 的列，然后通过 @relation 声明 deaprtmentId 的列引用 department 的 id 列。</p>
<p>测试下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma migrate dev <span class="hljs-attr">--name</span> ccc</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c10607651f14ead809f89b3086eaa2d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1056&amp;h=548&amp;s=94094&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>可以看到，生成的 sql 是符合预期的：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78e645152f894a75bb8ba4fd674def09~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1872&amp;h=1030&amp;s=225160&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>并且在数据库里可以看到创建了对应的外键：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4b604c1743b49228e781a9056eb3291~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1968&amp;h=526&amp;s=174268&amp;e=png&amp;b=f4f2f2" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后是多对多：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3cff85632d247a8ba2af2544172e808~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1000&amp;h=936&amp;s=152941&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">kotlin</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-kotlin code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model Post {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id        <span class="hljs-built_in">Int</span>          <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement()</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="3">  title     String</span>
<span class="code-block-extension-codeLine" data-line-num="4">  content   String?</span>
<span class="code-block-extension-codeLine" data-line-num="5">  published <span class="hljs-built_in">Boolean</span>      <span class="hljs-meta">@default(false)</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">  tags      TagOnPosts[]</span>
<span class="code-block-extension-codeLine" data-line-num="7">}</span>
<span class="code-block-extension-codeLine" data-line-num="8"></span>
<span class="code-block-extension-codeLine" data-line-num="9">model Tag {</span>
<span class="code-block-extension-codeLine" data-line-num="10">  id    <span class="hljs-built_in">Int</span>          <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement()</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="11">  name  String</span>
<span class="code-block-extension-codeLine" data-line-num="12">  posts TagOnPosts[]</span>
<span class="code-block-extension-codeLine" data-line-num="13">}</span>
<span class="code-block-extension-codeLine" data-line-num="14"></span>
<span class="code-block-extension-codeLine" data-line-num="15">model TagOnPosts {</span>
<span class="code-block-extension-codeLine" data-line-num="16">  post   Post <span class="hljs-meta">@relation(fields: [postId], references: [id])</span></span>
<span class="code-block-extension-codeLine" data-line-num="17">  postId <span class="hljs-built_in">Int</span></span>
<span class="code-block-extension-codeLine" data-line-num="18"></span>
<span class="code-block-extension-codeLine" data-line-num="19">  tag    Tag <span class="hljs-meta">@relation(fields: [tagId], references: [id])</span></span>
<span class="code-block-extension-codeLine" data-line-num="20">  tagId  <span class="hljs-built_in">Int</span></span>
<span class="code-block-extension-codeLine" data-line-num="21"></span>
<span class="code-block-extension-codeLine" data-line-num="22">  @<span class="hljs-meta">@id([postId, tagId])</span></span>
<span class="code-block-extension-codeLine" data-line-num="23">}</span>
</code></pre>
<p>有 sql 的基础很容易看懂，多对多需要创建一个中间表，中间表里有两个外键分别关联这两个表。</p>
<p>然后用 @@id 创建一个联合主键。</p>
<p>测试下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma migrate dev <span class="hljs-attr">--name</span> ddd</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea9888498ab247cd8876e17e3ac0cd0a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1184&amp;h=522&amp;s=95743&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>生成的 sql 如下：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27d41fee3e24455da43cd3d3d0bb9ada~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1950&amp;h=1294&amp;s=285317&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>中间表创建了 postId 和 tagId 的联合主键，并且创建了两个外键。</p>
<p>在 mysql 里可以看到这两个外键：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b2c0c956df74958b7653a0410678926~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1962&amp;h=830&amp;s=263926&amp;e=png&amp;b=f4f2f2" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这就是一对多、多对多的映射方式。</p>
<p>至于一对一，那个就是在多的那一侧添加一个 unique 约束就好了：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/736ff79d04d842e3b653410a6852214e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1276&amp;h=582&amp;s=121715&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这样就把一对多变成了一对一。</p>
<p>此外，还有一个 enum 的语法，就是可以指定某个字段只能取一些枚举值：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd190610d56c45c4a8912463455dbb9a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=904&amp;h=558&amp;s=72300&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">java</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-java code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">model Aaa {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  id      Int      <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement())</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">  name    String?</span>
<span class="code-block-extension-codeLine" data-line-num="4">  role    EEE     <span class="hljs-meta">@default(CCC)</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">EEE</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="8">  BBB</span>
<span class="code-block-extension-codeLine" data-line-num="9">  CCC</span>
<span class="code-block-extension-codeLine" data-line-num="10">  DDD</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
</code></pre>
<p>创建迁移：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma migrate dev <span class="hljs-attr">--name</span> eee</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/125acd9f027f49d6af94a4afbfb6a8fa~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1060&amp;h=556&amp;s=95431&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>生成的 sql 如下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/54bcd4b2064743ab98dac25a4024e7f3~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1024&amp;h=458&amp;s=84212&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这个 enum 也是 sql 支持的语法（我们前面貌似没用过）。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a085bbdf8364c67b2d7909cf1e96c52~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1216&amp;h=698&amp;s=205426&amp;e=png&amp;b=edeae9" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这就是 prisma schema 的常用语法了，有一些不常用的没有列出来，大家遇去查<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.prisma.io%2Fdocs%2Fconcepts%2Fcomponents%2Fprisma-schema" target="_blank" rel="nofollow noopener noreferrer" title="https://www.prisma.io/docs/concepts/components/prisma-schema" ref="nofollow noopener noreferrer">schema 文档</a>就好了。</p>
<p>最后，再看下生成的文档：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx http-server ./generated/docs</span>
</code></pre>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba9877c8b663449280fc05d6ed5929e7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=748&amp;h=538&amp;s=91482&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>每一个表的字段还有可用的 CRUD 方法都列出来了：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6fdbc5df3c0248b4b815923b59beeb16~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1854&amp;h=1304&amp;s=240510&amp;e=png&amp;b=ffffff" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>确实很方便。</p>
<p>案例代码在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuarkGluonPlasma%2Fnestjs-course-code%2Ftree%2Fmain%2Fprisma-schema" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/prisma-schema" ref="nofollow noopener noreferrer">小册仓库</a></p>
<h2 data-id="heading-0">总结</h2>
<p>这节我们学习了 prisma schema 的常用语法。</p>
<p>generator 部分可以指定多种生成器，比如生成 json 生成 docs 等，可以指定生成代码的位置。</p>
<p>datasource 是配置数据库的类型和连接 url 的。</p>
<p>model 部分定义和数据库表的对应关系：</p>
<ul>
<li><strong>@id</strong> 定义主键</li>
<li><strong>@default</strong> 定义默认值</li>
<li><strong>@map</strong> 定义字段在数据库中的名字</li>
<li><strong>@db.xx</strong> 定义对应的具体类型</li>
<li><strong>@updatedAt</strong> 定义更新时间的列</li>
<li><strong>@unique</strong> 添加唯一约束</li>
<li><strong>@relation</strong> 定义外键引用</li>
<li><strong>@@map</strong> 定义表在数据库中的名字</li>
<li><strong>@@index</strong> 定义索引</li>
<li><strong>@@id</strong> 定义联合主键</li>
</ul>
<p>此外，还可以通过 enum 来创建枚举类型。</p>
<p>这些就是常用的 schema 语法了。</p></div>