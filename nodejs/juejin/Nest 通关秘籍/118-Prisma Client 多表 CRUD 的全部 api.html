<header>
        <style>
            .markdown-body{
                width: 80%;
                margin: auto;
            }
            .code-block-extension-header{
                display: none;
            }
        </style>
    </header><div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上节我们过了一遍 Prisma Client 做 CRUD 的 api，但那只是针对单表的，这节我们把涉及到多表的 CRUD 的 api 过一遍。</p>
<p>创建个新项目：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-built_in">mkdir</span> prisma-client-api2 </span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-built_in">cd</span> prisma-client-api2 </span>
<span class="code-block-extension-codeLine" data-line-num="3">npm init -y</span>
</code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2d719a533be44b8968b41c74b03946d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=890&amp;h=702&amp;s=91178&amp;e=png&amp;b=000000" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>进入项目，执行 init 命令：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">csharp</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-csharp code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma <span class="hljs-keyword">init</span></span>
</code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29216dde7e8e40be94a8a27f85f0c4af~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1010&amp;h=624&amp;s=105602&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>生成了 .env 和 schema 文件：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51cd28df37d6483abc67cffc76b7cc3e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=512&amp;h=192&amp;s=18392&amp;e=png&amp;b=1e1e1e" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后改下 .env 文件的数据库连接信息：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9260844466e7496fa11bdf18a5da4e14~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1026&amp;h=348&amp;s=134798&amp;e=png&amp;b=202020" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-attr">DATABASE_URL</span>=<span class="hljs-string">"mysql://root:guang@localhost:3306/prisma_test"</span></span>
</code></pre>
<p>改一下 datasource 的 provider 为 mysql，并且添加 model</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f083c8dc5c741679379620c15723342~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1358&amp;h=956&amp;s=184756&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">prisma</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-prisma code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">generator client {</span>
<span class="code-block-extension-codeLine" data-line-num="2">  provider = "prisma-client-js"</span>
<span class="code-block-extension-codeLine" data-line-num="3">}</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">datasource db {</span>
<span class="code-block-extension-codeLine" data-line-num="6">  provider = "mysql"</span>
<span class="code-block-extension-codeLine" data-line-num="7">  url      = env("DATABASE_URL")</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">model Department {</span>
<span class="code-block-extension-codeLine" data-line-num="11">  id        Int    @id @default(autoincrement())</span>
<span class="code-block-extension-codeLine" data-line-num="12">  name      String  @db.VarChar(20)</span>
<span class="code-block-extension-codeLine" data-line-num="13">  createTime DateTime @default(now())</span>
<span class="code-block-extension-codeLine" data-line-num="14">  updateTime DateTime @updatedAt</span>
<span class="code-block-extension-codeLine" data-line-num="15">  employees     Employee[]</span>
<span class="code-block-extension-codeLine" data-line-num="16">}</span>
<span class="code-block-extension-codeLine" data-line-num="17"></span>
<span class="code-block-extension-codeLine" data-line-num="18">model Employee {</span>
<span class="code-block-extension-codeLine" data-line-num="19">  id         Int       @id @default(autoincrement())</span>
<span class="code-block-extension-codeLine" data-line-num="20">  name      String     @db.VarChar(20)</span>
<span class="code-block-extension-codeLine" data-line-num="21">  phone     String     @db.VarChar(30)  </span>
<span class="code-block-extension-codeLine" data-line-num="22"></span>
<span class="code-block-extension-codeLine" data-line-num="23">  deaprtmentId Int</span>
<span class="code-block-extension-codeLine" data-line-num="24">  department     Department      @relation(fields: [deaprtmentId], references: [id])</span>
<span class="code-block-extension-codeLine" data-line-num="25">}</span>
</code></pre>
<p>之后执行 migrate reset 重置下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">perl</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-perl code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma migrate <span class="hljs-keyword">reset</span></span>
</code></pre>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e525d0d9692940caac47a3a05eac11f7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1072&amp;h=622&amp;s=88219&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后用 migrate dev 创建新的迁移：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx prisma migrate dev <span class="hljs-attr">--name</span> aaa</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9a0b116589243d2af8cf1c55ea02d1b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1188&amp;h=560&amp;s=87234&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>生成了 client 代码，还有 sql 文件。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a129c832d88b4cd1ae85015353b95a20~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=2034&amp;h=1060&amp;s=291405&amp;e=png&amp;b=1e1e1e" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>数据库中也多了这 2 个表：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55197603cc2d40a089abacdd197abea1~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1070&amp;h=484&amp;s=156945&amp;e=png&amp;b=f0eded" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f087fe832374ad8b88c5f9e684e350c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1012&amp;h=406&amp;s=114606&amp;e=png&amp;b=f0eded" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后来写下 client 的 crud 代码。</p>
<p>首先安装 ts、ts-node 包：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">sql</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-sql code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install typescript ts<span class="hljs-operator">-</span>node <span class="hljs-variable">@types</span><span class="hljs-operator">/</span>node <span class="hljs-comment">--save-dev</span></span>
</code></pre>
<p>创建 tsconfig.json</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">csharp</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-csharp code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx tsc --<span class="hljs-keyword">init</span></span>
</code></pre>
<p>把注释删掉，保留这些配置就行：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">json</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-json code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-punctuation">{</span></span>
<span class="code-block-extension-codeLine" data-line-num="2">  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es2016"</span><span class="hljs-punctuation">,</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"commonjs"</span><span class="hljs-punctuation">,</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span></span>
<span class="code-block-extension-codeLine" data-line-num="7">    <span class="hljs-attr">"forceConsistentCasingInFileNames"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span></span>
<span class="code-block-extension-codeLine" data-line-num="10">  <span class="hljs-punctuation">}</span></span>
<span class="code-block-extension-codeLine" data-line-num="11"><span class="hljs-punctuation">}</span></span>
</code></pre>
<p>创建 src/index.ts</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@prisma/client'</span></span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">const</span> prisma = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrismaClient</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="4">  <span class="hljs-attr">log</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="5">    {</span>
<span class="code-block-extension-codeLine" data-line-num="6">      <span class="hljs-attr">emit</span>: <span class="hljs-string">'stdout'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="7">      <span class="hljs-attr">level</span>: <span class="hljs-string">'query'</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">    },</span>
<span class="code-block-extension-codeLine" data-line-num="9">  ],</span>
<span class="code-block-extension-codeLine" data-line-num="10">});</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) { </span>
<span class="code-block-extension-codeLine" data-line-num="13">}</span>
<span class="code-block-extension-codeLine" data-line-num="14"></span>
<span class="code-block-extension-codeLine" data-line-num="15"><span class="hljs-title function_">main</span>();</span>
</code></pre>
<p>然后分别做下 CRUD。</p>
<p>首先是插入数据：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@prisma/client'</span></span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">const</span> prisma = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrismaClient</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="4">  <span class="hljs-attr">log</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="5">    {</span>
<span class="code-block-extension-codeLine" data-line-num="6">      <span class="hljs-attr">emit</span>: <span class="hljs-string">'stdout'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="7">      <span class="hljs-attr">level</span>: <span class="hljs-string">'query'</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">    },</span>
<span class="code-block-extension-codeLine" data-line-num="9">  ],</span>
<span class="code-block-extension-codeLine" data-line-num="10">});</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test1</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="13">   <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">create</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="14">        <span class="hljs-attr">data</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="15">            <span class="hljs-attr">name</span>: <span class="hljs-string">'技术部'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="16">            <span class="hljs-attr">employees</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="17">                <span class="hljs-attr">create</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="18">                    {</span>
<span class="code-block-extension-codeLine" data-line-num="19">                        <span class="hljs-attr">name</span>: <span class="hljs-string">'小张'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="20">                        <span class="hljs-attr">phone</span>: <span class="hljs-string">'13333333333'</span></span>
<span class="code-block-extension-codeLine" data-line-num="21">                    },</span>
<span class="code-block-extension-codeLine" data-line-num="22">                    {</span>
<span class="code-block-extension-codeLine" data-line-num="23">                        <span class="hljs-attr">name</span>: <span class="hljs-string">'小李'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="24">                        <span class="hljs-attr">phone</span>: <span class="hljs-string">'13222222222'</span></span>
<span class="code-block-extension-codeLine" data-line-num="25">                    }</span>
<span class="code-block-extension-codeLine" data-line-num="26">                ]</span>
<span class="code-block-extension-codeLine" data-line-num="27">            }</span>
<span class="code-block-extension-codeLine" data-line-num="28">        }</span>
<span class="code-block-extension-codeLine" data-line-num="29">   })</span>
<span class="code-block-extension-codeLine" data-line-num="30">}</span>
<span class="code-block-extension-codeLine" data-line-num="31"></span>
<span class="code-block-extension-codeLine" data-line-num="32"><span class="hljs-title function_">test1</span>();</span>
</code></pre>
<p>插入关联 model 的数据的时候，也是用 create 指定：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/634ccb2291f44010a91f42fad5191a15~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=922&amp;h=880&amp;s=93789&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>测试下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npx ts-node ./src/index.ts</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99422760137c4c939fd32afd811a17b8~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1374&amp;h=242&amp;s=81019&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>在 mysql workbench 里看下结果：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e20e8a26e5254d6aadcaea6853bcd75e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1306&amp;h=452&amp;s=146375&amp;e=png&amp;b=f0eded" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/393d9cb0043f4d2eb89d4e90687e6887~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1074&amp;h=454&amp;s=144846&amp;e=png&amp;b=efeceb" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>确实，数据都被正确插入了。</p>
<p>当然，你也可以用这种写法：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6fde3edfc2b49e3b2194a0d2ece5e6a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=904&amp;h=868&amp;s=93803&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test2</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">create</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">         <span class="hljs-attr">data</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">             <span class="hljs-attr">name</span>: <span class="hljs-string">'技术部'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="5">             <span class="hljs-attr">employees</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="6">                 <span class="hljs-attr">createMany</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="7">                    <span class="hljs-attr">data</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="8">                        {</span>
<span class="code-block-extension-codeLine" data-line-num="9">                            <span class="hljs-attr">name</span>: <span class="hljs-string">'小王'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="10">                            <span class="hljs-attr">phone</span>: <span class="hljs-string">'13333333333'</span></span>
<span class="code-block-extension-codeLine" data-line-num="11">                        },</span>
<span class="code-block-extension-codeLine" data-line-num="12">                        {</span>
<span class="code-block-extension-codeLine" data-line-num="13">                            <span class="hljs-attr">name</span>: <span class="hljs-string">'小周'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="14">                            <span class="hljs-attr">phone</span>: <span class="hljs-string">'13222222222'</span></span>
<span class="code-block-extension-codeLine" data-line-num="15">                        }</span>
<span class="code-block-extension-codeLine" data-line-num="16">                    ],</span>
<span class="code-block-extension-codeLine" data-line-num="17"></span>
<span class="code-block-extension-codeLine" data-line-num="18">                 }</span>
<span class="code-block-extension-codeLine" data-line-num="19">             }</span>
<span class="code-block-extension-codeLine" data-line-num="20">         }</span>
<span class="code-block-extension-codeLine" data-line-num="21">    })</span>
<span class="code-block-extension-codeLine" data-line-num="22">}</span>
<span class="code-block-extension-codeLine" data-line-num="23"></span>
<span class="code-block-extension-codeLine" data-line-num="24"><span class="hljs-title function_">test2</span>();</span>
</code></pre>
<p>跑一下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86cba5416ddc402c9d29b8f0d01ceb4a~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=912&amp;h=210&amp;s=55131&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>效果一样：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/394a883a6ee04d4499305daa12653dac~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=796&amp;h=204&amp;s=75130&amp;e=png&amp;b=fbfbfb" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a4e6050a5af47b3aaafd7820f7959ca~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=580&amp;h=306&amp;s=71258&amp;e=png&amp;b=f8f8f8" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>那如何关联查询呢？</p>
<p>可以这样写：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test3</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">findUnique</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">            <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">        },</span>
<span class="code-block-extension-codeLine" data-line-num="6">        <span class="hljs-attr">include</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="7">            <span class="hljs-attr">employees</span>: <span class="hljs-literal">true</span></span>
<span class="code-block-extension-codeLine" data-line-num="8">        }</span>
<span class="code-block-extension-codeLine" data-line-num="9">    });</span>
<span class="code-block-extension-codeLine" data-line-num="10">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res1);</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">    <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">findUnique</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="13">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="14">            <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="15">        },</span>
<span class="code-block-extension-codeLine" data-line-num="16">        <span class="hljs-attr">include</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="17">            <span class="hljs-attr">employees</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="18">                <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="19">                    <span class="hljs-attr">name</span>: <span class="hljs-string">'小张'</span></span>
<span class="code-block-extension-codeLine" data-line-num="20">                },</span>
<span class="code-block-extension-codeLine" data-line-num="21">                <span class="hljs-attr">select</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="22">                    <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span></span>
<span class="code-block-extension-codeLine" data-line-num="23">                }</span>
<span class="code-block-extension-codeLine" data-line-num="24">            }</span>
<span class="code-block-extension-codeLine" data-line-num="25">        }</span>
<span class="code-block-extension-codeLine" data-line-num="26">    });</span>
<span class="code-block-extension-codeLine" data-line-num="27">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res2);</span>
<span class="code-block-extension-codeLine" data-line-num="28"></span>
<span class="code-block-extension-codeLine" data-line-num="29">    <span class="hljs-keyword">const</span> res3 = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">findUnique</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="30">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="31">            <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="32">        }</span>
<span class="code-block-extension-codeLine" data-line-num="33">    }).<span class="hljs-title function_">employees</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="34">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res3);</span>
<span class="code-block-extension-codeLine" data-line-num="35">}</span>
<span class="code-block-extension-codeLine" data-line-num="36"></span>
<span class="code-block-extension-codeLine" data-line-num="37"><span class="hljs-title function_">test3</span>();</span>
</code></pre>
<p>查询 department 的时候，通过 include 指定关联查询出 employees。</p>
<p>include 还可以指定 where 等查询的参数，进一步过滤。</p>
<p>此外，你也可以在查出 department 后调用 empolyees() 方法来查询。</p>
<p>可以看到，都能正确查出关联数据：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/483173bf0da443ada07efb5a0dc36b61~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1164&amp;h=934&amp;s=202146&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>再就是关联更新：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test4</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">update</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">            <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">        },</span>
<span class="code-block-extension-codeLine" data-line-num="6">        <span class="hljs-attr">data</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="7">            <span class="hljs-attr">name</span>: <span class="hljs-string">'销售部'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="8">            <span class="hljs-attr">employees</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="9">                <span class="hljs-attr">create</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="10">                    {</span>
<span class="code-block-extension-codeLine" data-line-num="11">                        <span class="hljs-attr">name</span>: <span class="hljs-string">'小刘'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="12">                        <span class="hljs-attr">phone</span>: <span class="hljs-string">'13266666666'</span></span>
<span class="code-block-extension-codeLine" data-line-num="13">                    }</span>
<span class="code-block-extension-codeLine" data-line-num="14">                ]</span>
<span class="code-block-extension-codeLine" data-line-num="15">            }</span>
<span class="code-block-extension-codeLine" data-line-num="16">        }</span>
<span class="code-block-extension-codeLine" data-line-num="17">    });</span>
<span class="code-block-extension-codeLine" data-line-num="18">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res1);</span>
<span class="code-block-extension-codeLine" data-line-num="19">}</span>
<span class="code-block-extension-codeLine" data-line-num="20"></span>
<span class="code-block-extension-codeLine" data-line-num="21"><span class="hljs-title function_">test4</span>();</span>
</code></pre>
<p>比如我在更新 department 的时候关联插入了一条 employee 的记录。</p>
<p>跑一下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef0fdb1edee04269a19ffe5d9bab87ce~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1078&amp;h=442&amp;s=97332&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>在 mysql workbench 里可以看到，id 为 1 的 department 更新了：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f714834fc2ee442b8daee35721af79bd~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=824&amp;h=224&amp;s=69443&amp;e=png&amp;b=f7f7f7" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>关联插入了一条 employee 的记录：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b95da0f1b5624d1a84b72e659dbd33d4~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=566&amp;h=334&amp;s=79102&amp;e=png&amp;b=f7f7f7" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8fe049ad64a4c53ae8ad7e66705aee9~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=582&amp;h=312&amp;s=86589&amp;e=png&amp;b=f9f9f9" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>更新 department 的时候，除了可以插入 empolyee 的数据，也可以和别的 empolyee 建立关联。</p>
<p>比如 id 为 4 的 empolyee：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8cbfe2b5b54b4bd48b4aae7306894b6c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=566&amp;h=348&amp;s=87349&amp;e=png&amp;b=f9f9f9" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>现在他关联的是 id 为 2 的 department。</p>
<p>我们 update 的时候使用 connect 和它关联：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test5</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">update</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">            <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">        },</span>
<span class="code-block-extension-codeLine" data-line-num="6">        <span class="hljs-attr">data</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="7">            <span class="hljs-attr">name</span>: <span class="hljs-string">'销售部'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="8">            <span class="hljs-attr">employees</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="9">                <span class="hljs-attr">connect</span>: [</span>
<span class="code-block-extension-codeLine" data-line-num="10">                    {</span>
<span class="code-block-extension-codeLine" data-line-num="11">                        <span class="hljs-attr">id</span>: <span class="hljs-number">4</span></span>
<span class="code-block-extension-codeLine" data-line-num="12">                    }</span>
<span class="code-block-extension-codeLine" data-line-num="13">                ]</span>
<span class="code-block-extension-codeLine" data-line-num="14">            }</span>
<span class="code-block-extension-codeLine" data-line-num="15">        }</span>
<span class="code-block-extension-codeLine" data-line-num="16">    });</span>
<span class="code-block-extension-codeLine" data-line-num="17">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res1);</span>
<span class="code-block-extension-codeLine" data-line-num="18">}</span>
<span class="code-block-extension-codeLine" data-line-num="19"><span class="hljs-title function_">test5</span>();</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45b36288047e45b185047c5913776413~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=848&amp;h=770&amp;s=89854&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>跑一下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/502561f1da854860b6baf9a8159191d7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=828&amp;h=442&amp;s=88252&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>刷新可以看到，id 为 4 的 employee 关联的 department 就变了：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d001d81bf504470792dd59b534139231~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=570&amp;h=314&amp;s=85581&amp;e=png&amp;b=fafafa" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>如果是某个 id 的数据存在就 connect，不存在就 create 呢？</p>
<p>可以这样写：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test6</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">department</span>.<span class="hljs-title function_">update</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">            <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">        },</span>
<span class="code-block-extension-codeLine" data-line-num="6">        <span class="hljs-attr">data</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="7">            <span class="hljs-attr">name</span>: <span class="hljs-string">'销售部'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="8">            <span class="hljs-attr">employees</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="9">                <span class="hljs-attr">connectOrCreate</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="10">                    <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="11">                        <span class="hljs-attr">id</span>: <span class="hljs-number">6</span></span>
<span class="code-block-extension-codeLine" data-line-num="12">                    },</span>
<span class="code-block-extension-codeLine" data-line-num="13">                    <span class="hljs-attr">create</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="14">                        <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="15">                        <span class="hljs-attr">name</span>: <span class="hljs-string">'小张'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="16">                        <span class="hljs-attr">phone</span>: <span class="hljs-string">'13256665555'</span></span>
<span class="code-block-extension-codeLine" data-line-num="17">                    }</span>
<span class="code-block-extension-codeLine" data-line-num="18">                }</span>
<span class="code-block-extension-codeLine" data-line-num="19">            }</span>
<span class="code-block-extension-codeLine" data-line-num="20">        }</span>
<span class="code-block-extension-codeLine" data-line-num="21">    });</span>
<span class="code-block-extension-codeLine" data-line-num="22">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res1);</span>
<span class="code-block-extension-codeLine" data-line-num="23">}</span>
<span class="code-block-extension-codeLine" data-line-num="24"><span class="hljs-title function_">test6</span>();</span>
</code></pre>
<p>第一次跑，执行的是 insert：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d7ca69a88d64e40bb52bf841560fd2c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=890&amp;h=484&amp;s=99574&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/624fbc54470b4f1fb349cdfc8c13aee0~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=552&amp;h=342&amp;s=95419&amp;e=png&amp;b=fafafa" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>第二次跑，就是 update 了：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d52d7347cdc4d0280cb3a54f30561ba~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1222&amp;h=496&amp;s=112662&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>也就是说，update 的时候可以通过 create、connect、connectOrCreate 来插入新的关联 model 的记录或者关联已有的记录。</p>
<p>当然，create 的时候也可以这样：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c53b43c1124444939e8ed8bcf99ef7b7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=658&amp;h=386&amp;s=54689&amp;e=png&amp;b=202020" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>效果一样，就不一个个测试了。</p>
<p>再就是删除：</p>
<p>如果我们想删除 id 为 1 的 department 的所有 empolyee，可以这样写：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test7</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">employee</span>.<span class="hljs-title function_">deleteMany</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">        <span class="hljs-attr">where</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="4">            <span class="hljs-attr">department</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="5">                <span class="hljs-attr">id</span>: <span class="hljs-number">1</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">            }</span>
<span class="code-block-extension-codeLine" data-line-num="7">        },</span>
<span class="code-block-extension-codeLine" data-line-num="8">    });</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
<span class="code-block-extension-codeLine" data-line-num="10"><span class="hljs-title function_">test7</span>();</span>
</code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/767766da6f174af2a443da2fdb9a75c7~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=892&amp;h=148&amp;s=37877&amp;e=png&amp;b=191919" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f916a94bfa2745648c0b6c3ba2f94e7d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=706&amp;h=378&amp;s=100166&amp;e=gif&amp;f=18&amp;b=f7f7f7" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这就是多个 model 关联时的 CRUD。</p>
<p>此外，Prisma 还可以直接执行 sql：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test8</span>(<span class="hljs-params"></span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">$executeRaw</span><span class="hljs-string">`TRUNCATE TABLE Employee`</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> prisma.<span class="hljs-property">$queryRaw</span><span class="hljs-string">`select * from Department`</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);</span>
<span class="code-block-extension-codeLine" data-line-num="6">}</span>
<span class="code-block-extension-codeLine" data-line-num="7"><span class="hljs-title function_">test8</span>();</span>
</code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c7d176c1f8444d0975bc83e700e67a3~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=708&amp;h=502&amp;s=68097&amp;e=png&amp;b=181818" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这样，当上面的 api 都不能满足需求的时候，你就可以直接执行 sql。</p>
<p>案例代码在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuarkGluonPlasma%2Fnestjs-course-code%2Ftree%2Fmain%2Fprisma-client-api2" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/prisma-client-api2" ref="nofollow noopener noreferrer">小册仓库</a></p>
<h2 data-id="heading-0">总结</h2>
<p>这节我们过了一遍多 model 关联的时候涉及到多个表的 CRUD 方法。</p>
<p>还是 findXxx、updateXxx、deleteXxx、createXxx 那些方法，只不过查询的时候可以通过 include 包含关联记录，新增修改的时候可以通过 create、connect、connectOrCreate 来关联或者插入记录。</p>
<p>此外，你还可以直接执行 sql。</p>
<p>通过这些 api，我们就能完成各种 CRUD 需求了。</p></div>