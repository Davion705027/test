<header>
        <style>
            .markdown-body{
                width: 80%;
                margin: auto;
            }
            .code-block-extension-header{
                display: none;
            }
        </style>
    </header><div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发，想必经常做的事情就是：调接口、画页面、调接口、画页面...</p>
<p>调用的接口大概率是 restful 的，也就是类似这种：</p>
<p>/students 查询所有学生信息</p>
<p>/student/1 查询 id 为 1 的学生信息</p>
<p>上面说的是 get 请求。</p>
<p>如果对 /student/1 发送 POST、PUT、DELETE 请求，就分别代表了新增、修改、删除。</p>
<p>这就是 restful 风格的 web 接口。</p>
<p>这种接口返回什么信息是服务端那边决定的，客户端只是传一下参数。</p>
<p>而不同场景下需要的数据不同，这时候可能就得新开发一个接口。特别是在版本更新的时候，接口会有所变动。</p>
<p>这样就很容易导致一大堆类似的接口。</p>
<p>facebook 当时也遇到了这个问题，于是他们创造了一种新的接口实现方案：GraphQL。</p>
<p>用了 GraphQL 之后，返回什么数据不再是服务端说了算，而是客户端自己决定。</p>
<p>服务端只需要提供一个接口，客户端通过这个接口就可以取任意格式的数据，实现 CRUD。</p>
<p>比如想查询所有的学生，就可以这样：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69766c3214044ea9bb39bccec27ea53f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>想再查询他们的年龄，就可以这样：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e4e0ec81d7bd4ed4bf6c0db6313cdabd~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>想查询老师的名字和他教的学生，就可以这样：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29f59758180547c0b5e36f6f8bb85ad4~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>而这些都是在一个 http 接口里完成的！</p>
<p>感受了 GraphQL 的好处了没？</p>
<p><strong>一个 http 接口就能实现所有的 CRUD！</strong></p>
<p>那这么强大的 GraphQL 是怎么实现的呢？</p>
<p>我们先写个 demo 快速入门一下：</p>
<p>facebook 提供了 graphql 的 npm 包，但那个封装的不够好，一般我们会用基于 graphql 包的 @apollo/server 和 @apollo/client 的包来实现 graphql。</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-built_in">mkdir</span> graphql-crud-demo</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-built_in">cd</span> graphql-crud-demo</span>
<span class="code-block-extension-codeLine" data-line-num="3">npm init -y</span>
</code></pre>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fddedf2692a44a91af0ef6c0f02271bb~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=936&amp;h=668&amp;s=94837&amp;e=png&amp;b=010101" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>安装用到的包：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">bash</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-bash code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install @apollo/server</span>
</code></pre>
<p>然后在 index.js 写一下这段代码：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApolloServer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@apollo/server'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">const</span> typeDefs = <span class="hljs-string">`</span></span>
<span class="code-block-extension-codeLine" data-line-num="4">  type Student {</span>
<span class="code-block-extension-codeLine" data-line-num="5">    id: String,</span>
<span class="code-block-extension-codeLine" data-line-num="6">    name: String,</span>
<span class="code-block-extension-codeLine" data-line-num="7">    sex: Boolean</span>
<span class="code-block-extension-codeLine" data-line-num="8">    age: Int</span>
<span class="code-block-extension-codeLine" data-line-num="9">  }</span>
<span class="code-block-extension-codeLine" data-line-num="10"></span>
<span class="code-block-extension-codeLine" data-line-num="11">  type Teacher {</span>
<span class="code-block-extension-codeLine" data-line-num="12">    id: String,</span>
<span class="code-block-extension-codeLine" data-line-num="13">    name: String,</span>
<span class="code-block-extension-codeLine" data-line-num="14">    age: Int,</span>
<span class="code-block-extension-codeLine" data-line-num="15">    subject: [String],</span>
<span class="code-block-extension-codeLine" data-line-num="16">    students: [Student]</span>
<span class="code-block-extension-codeLine" data-line-num="17">  }</span>
<span class="code-block-extension-codeLine" data-line-num="18"></span>
<span class="code-block-extension-codeLine" data-line-num="19">  type Query {</span>
<span class="code-block-extension-codeLine" data-line-num="20">    students: [Student],</span>
<span class="code-block-extension-codeLine" data-line-num="21">    teachers: [Teacher],</span>
<span class="code-block-extension-codeLine" data-line-num="22">  }</span>
<span class="code-block-extension-codeLine" data-line-num="23"></span>
<span class="code-block-extension-codeLine" data-line-num="24">  schema {</span>
<span class="code-block-extension-codeLine" data-line-num="25">    query: Query</span>
<span class="code-block-extension-codeLine" data-line-num="26">  }</span>
<span class="code-block-extension-codeLine" data-line-num="27">`;</span>
</code></pre>
<p>比较容易看懂，定义了一个 Student 的对象类型，有 id、name、sex、age 这几个字段。</p>
<p>又定义了一个 Teacher 的对象类型，有 id、name、age、subject、students 这几个字段。students 字段是他教的学生的信息。</p>
<p>然后定义了查询的入口，可以查 students 和 teachers 的信息。</p>
<p>这样就是一个 schema。</p>
<p>对象类型和对象类型之间有关联关系，老师关联了学生、学生也可以关联老师，关联来关联去这不就是一个图么，也就是 graph。</p>
<p>GraphQL 全称是 graph query language，就是从这个对象的 graph 中查询数据的。</p>
<p>现在我们声明的只是对象类型的关系，还要知道这些类型的具体数据，取数据的这部分叫做 resolver。</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">const</span> students = [</span>
<span class="code-block-extension-codeLine" data-line-num="2">    {</span>
<span class="code-block-extension-codeLine" data-line-num="3">      <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">      <span class="hljs-attr">name</span>: <span class="hljs-keyword">async</span> () =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="5">        <span class="hljs-keyword">await</span> <span class="hljs-string">'取数据'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="6">        <span class="hljs-keyword">return</span> <span class="hljs-string">'光光'</span></span>
<span class="code-block-extension-codeLine" data-line-num="7">      },</span>
<span class="code-block-extension-codeLine" data-line-num="8">      <span class="hljs-attr">sex</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="9">      <span class="hljs-attr">age</span>: <span class="hljs-number">12</span></span>
<span class="code-block-extension-codeLine" data-line-num="10">    },</span>
<span class="code-block-extension-codeLine" data-line-num="11">    {</span>
<span class="code-block-extension-codeLine" data-line-num="12">      <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="13">      <span class="hljs-attr">name</span>:<span class="hljs-string">'东东'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="14">      <span class="hljs-attr">sex</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="15">      <span class="hljs-attr">age</span>: <span class="hljs-number">13</span></span>
<span class="code-block-extension-codeLine" data-line-num="16">    },</span>
<span class="code-block-extension-codeLine" data-line-num="17">    {</span>
<span class="code-block-extension-codeLine" data-line-num="18">      <span class="hljs-attr">id</span>: <span class="hljs-string">'3'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="19">      <span class="hljs-attr">name</span>:<span class="hljs-string">'小红'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="20">      <span class="hljs-attr">sex</span>: <span class="hljs-literal">false</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="21">      <span class="hljs-attr">age</span>: <span class="hljs-number">11</span></span>
<span class="code-block-extension-codeLine" data-line-num="22">    },</span>
<span class="code-block-extension-codeLine" data-line-num="23">];</span>
<span class="code-block-extension-codeLine" data-line-num="24"></span>
<span class="code-block-extension-codeLine" data-line-num="25"><span class="hljs-keyword">const</span> teachers = [</span>
<span class="code-block-extension-codeLine" data-line-num="26">  {</span>
<span class="code-block-extension-codeLine" data-line-num="27">    <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="28">    <span class="hljs-attr">name</span>: <span class="hljs-string">'神光'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="29">    <span class="hljs-attr">sex</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="30">    <span class="hljs-attr">subject</span>: [<span class="hljs-string">'体育'</span>, <span class="hljs-string">'数学'</span>],</span>
<span class="code-block-extension-codeLine" data-line-num="31">    <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="32">    <span class="hljs-attr">students</span>: students</span>
<span class="code-block-extension-codeLine" data-line-num="33">  }</span>
<span class="code-block-extension-codeLine" data-line-num="34">]</span>
<span class="code-block-extension-codeLine" data-line-num="35"></span>
<span class="code-block-extension-codeLine" data-line-num="36"><span class="hljs-keyword">const</span> resolvers = {</span>
<span class="code-block-extension-codeLine" data-line-num="37">    <span class="hljs-title class_">Query</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="38">      <span class="hljs-attr">students</span>: <span class="hljs-function">() =&gt;</span> students,</span>
<span class="code-block-extension-codeLine" data-line-num="39">      <span class="hljs-attr">teachers</span>: <span class="hljs-function">() =&gt;</span> teachers</span>
<span class="code-block-extension-codeLine" data-line-num="40">    }</span>
<span class="code-block-extension-codeLine" data-line-num="41">};</span>
</code></pre>
<p>resolver 是取对象类型对应的数据的，每个字段都可以写一个 async 函数，里面执行 sql、访问接口等都可以，最终返回取到的数据。</p>
<p>当然，直接写具体的数据也是可以的。</p>
<p>这样有了 schema 类型定义，有了取数据的 resovler，就可以跑起 graphql 服务了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92e02989bef0441da2b47d057ffcda1c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1400&amp;h=1164&amp;s=182844&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>也就是这样：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { startStandaloneServer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@apollo/server/standalone'</span> </span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloServer</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="4">    typeDefs,</span>
<span class="code-block-extension-codeLine" data-line-num="5">    resolvers,</span>
<span class="code-block-extension-codeLine" data-line-num="6">});</span>
<span class="code-block-extension-codeLine" data-line-num="7">  </span>
<span class="code-block-extension-codeLine" data-line-num="8"><span class="hljs-keyword">const</span> { url } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">startStandaloneServer</span>(server, {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-attr">listen</span>: { <span class="hljs-attr">port</span>: <span class="hljs-number">4000</span> },</span>
<span class="code-block-extension-codeLine" data-line-num="10">});</span>
<span class="code-block-extension-codeLine" data-line-num="11">  </span>
<span class="code-block-extension-codeLine" data-line-num="12"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🚀  Server ready at: <span class="hljs-subst">${url}</span>`</span>);</span>
</code></pre>
<p>传入 schema 类型定义和取数据的 resolver，就可以用 node 把服务跑起来。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a76c82f15d347deb8b0dc7bc9e1258f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>有同学可能问了，node 可以直接解析 esm 模块么？</p>
<p>可以的。只需要在 package.json 中声明 type 为 module：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/764dd70c276645b1a20049d0b2605955~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>那所有的 .js 就都会作为 esm 模块解析：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88a61d897c2f4578ad9196303fd98126~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>跑起来之后，浏览器访问一下：</p>
<p>就可以看到这样的 sandbox，这里可以执行 graphql 的查询：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3d94c3284c84d7ab5e5be77ff428e86~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>（graphql 接口是监听 POST 请求的，用 get 请求这个 url 才会跑这个调试的工具）</p>
<p>我查询所有学生的 id、name、age 就可以这样：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">graphql</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-graphql code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">query Query {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    students {</span>
<span class="code-block-extension-codeLine" data-line-num="3">        name,</span>
<span class="code-block-extension-codeLine" data-line-num="4">        id</span>
<span class="code-block-extension-codeLine" data-line-num="5">    }</span>
<span class="code-block-extension-codeLine" data-line-num="6">}</span>
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b278c7267b504004ab7ae454b5050424~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81b8b08007a34bc996425019a8650349~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这里 “光光” 那个学生是异步取的数据，resolver 会执行对应的异步函数，拿到最终数据：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f11da7e9bb294f35a96b8ab225353ef8~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>取老师的信息就可以这样：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ecd1871863014c3dafe5d3760efe03c9~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这样我们就实现了一个 graphql 接口！</p>
<p>感觉到什么叫客户端决定取什么数据了么？</p>
<p>当然，我们这里是在 sandbox 里测的，用 @apollo/client 包也很简单。</p>
<p>比如 react 的 graphql 客户端是这样的：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1bc53b8890a94cb183fe664fe801049e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>一个 gql 的 api 来写查询语言，一个 useQuery 的 api 来执行查询。</p>
<p>学起来很简单。</p>
<p>我们之后还是直接在 sandbox 里测试。</p>
<p>有的同学可能会说，如果我想查询某个名字的老师的信息呢？</p>
<p>怎么传参数？</p>
<p>graphql 当然是支持的，这样写：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8b2178e3ad842fba02af787140d7f70~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1226&amp;h=1112&amp;s=143647&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">ini</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-ini code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">type Query {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    students: <span class="hljs-section">[Student]</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="3">    teachers: <span class="hljs-section">[Teacher]</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    studentsbyTeacherName(name: String!): <span class="hljs-section">[Student]</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
</code></pre>
<p>新加一个 query 入口，声明一个 name 的参数。（这里 String 后的 ! 代表不能为空）</p>
<p>然后它对应的 resolver 就是这样的：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46045692e6374bcfacaa01b5f3c11308~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1120&amp;h=946&amp;s=132917&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">const</span> resolvers = {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-title class_">Query</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="3">      <span class="hljs-attr">students</span>: <span class="hljs-function">() =&gt;</span> students,</span>
<span class="code-block-extension-codeLine" data-line-num="4">      <span class="hljs-attr">teachers</span>: <span class="hljs-function">() =&gt;</span> teachers,</span>
<span class="code-block-extension-codeLine" data-line-num="5">      <span class="hljs-attr">studentsbyTeacherName</span>: <span class="hljs-keyword">async</span> (...args) =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="6">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(args);</span>
<span class="code-block-extension-codeLine" data-line-num="7"></span>
<span class="code-block-extension-codeLine" data-line-num="8">        <span class="hljs-keyword">await</span> <span class="hljs-string">'执行了一个异步查询'</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">        <span class="hljs-keyword">return</span> students</span>
<span class="code-block-extension-codeLine" data-line-num="10">      }</span>
<span class="code-block-extension-codeLine" data-line-num="11">    }</span>
<span class="code-block-extension-codeLine" data-line-num="12">};</span>
</code></pre>
<p>studentsbyTeacherName 字段的 resolver 是一个异步函数，里面执行了查询，然后返回了查到的学生信息。</p>
<p>我们打印下参数看看传过来的是什么。</p>
<p>有参数的查询是这样的：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc9883cfac5c4990a19e3804ea397d8f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>传入老师的 name 参数为 111，返回查到的学生的 id、name 信息。</p>
<p>可以看到返回的就是查询到的结果。</p>
<p>而服务端的 resolver 接收到的参数是这样的：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ec04705f8a04fe78a88d61fb74d1033~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>其余的几个参数不用管，只要知道第二个参数就是客户端传过来的查询参数就好了。</p>
<p>这样我们就可以根据这个 name 参数实现异步的查询，然后返回数据。</p>
<p>这就实现了有参数的查询。</p>
<p>不是说 graphql 能取代 restful 做 CRUD 么？那增删改怎么做呢？</p>
<p>其实看到上面的有参数的查询应该就能想到了，其实写起来差不多。</p>
<p>在 schema 里添加这样一段类型定义：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d60bf2fdfd24d019ba09a3ec5a3c41b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp#?w=1186&amp;h=1100&amp;s=153842&amp;e=png&amp;b=1f1f1f" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">grqphql</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-grqphql code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">type Res {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    success: Boolean</span>
<span class="code-block-extension-codeLine" data-line-num="3">    id: String</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
<span class="code-block-extension-codeLine" data-line-num="5"></span>
<span class="code-block-extension-codeLine" data-line-num="6">type Mutation {</span>
<span class="code-block-extension-codeLine" data-line-num="7">    addStudent(name:String! age:Int! sex:Boolean!): Res</span>
<span class="code-block-extension-codeLine" data-line-num="8"></span>
<span class="code-block-extension-codeLine" data-line-num="9">    updateStudent(id: String! name:String! age:Int! sex:Boolean!): Res</span>
<span class="code-block-extension-codeLine" data-line-num="10"></span>
<span class="code-block-extension-codeLine" data-line-num="11">    deleteStudent(id: String!): Res</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
<span class="code-block-extension-codeLine" data-line-num="13"></span>
<span class="code-block-extension-codeLine" data-line-num="14">schema {</span>
<span class="code-block-extension-codeLine" data-line-num="15">    mutation: Mutation</span>
<span class="code-block-extension-codeLine" data-line-num="16">    query: Query</span>
<span class="code-block-extension-codeLine" data-line-num="17">}</span>
</code></pre>
<p>和有参数的查询差不多，只不过这部分增删改的类型要定义在 mutation 部分。</p>
<p>然后 resolver 也要有对应的实现：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addStudent</span> (_, { name, age, sex }) {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    students.<span class="hljs-title function_">push</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">        <span class="hljs-attr">id</span>: <span class="hljs-string">'一个随机 id'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">        name,</span>
<span class="code-block-extension-codeLine" data-line-num="5">        age,</span>
<span class="code-block-extension-codeLine" data-line-num="6">        sex</span>
<span class="code-block-extension-codeLine" data-line-num="7">    });</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="9">      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="10">      <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span></span>
<span class="code-block-extension-codeLine" data-line-num="11">    }</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
<span class="code-block-extension-codeLine" data-line-num="13"></span>
<span class="code-block-extension-codeLine" data-line-num="14"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStudent</span> (_, { id, name, age, sex }) {</span>
<span class="code-block-extension-codeLine" data-line-num="15"></span>
<span class="code-block-extension-codeLine" data-line-num="16">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="17">      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="18">      <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span></span>
<span class="code-block-extension-codeLine" data-line-num="19">    }</span>
<span class="code-block-extension-codeLine" data-line-num="20">}</span>
<span class="code-block-extension-codeLine" data-line-num="21"></span>
<span class="code-block-extension-codeLine" data-line-num="22"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteStudent</span> (_, { id }) {</span>
<span class="code-block-extension-codeLine" data-line-num="23">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="24">      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="25">      <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span></span>
<span class="code-block-extension-codeLine" data-line-num="26">    }</span>
<span class="code-block-extension-codeLine" data-line-num="27">}</span>
<span class="code-block-extension-codeLine" data-line-num="28">  </span>
<span class="code-block-extension-codeLine" data-line-num="29"><span class="hljs-keyword">const</span> resolvers = {</span>
<span class="code-block-extension-codeLine" data-line-num="30">    <span class="hljs-title class_">Query</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="31">      <span class="hljs-attr">students</span>: <span class="hljs-function">() =&gt;</span> students,</span>
<span class="code-block-extension-codeLine" data-line-num="32">      <span class="hljs-attr">teachers</span>: <span class="hljs-function">() =&gt;</span> teachers,</span>
<span class="code-block-extension-codeLine" data-line-num="33">      <span class="hljs-attr">studentsbyTeacherName</span>: <span class="hljs-keyword">async</span> (...args) =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="34">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(args);</span>
<span class="code-block-extension-codeLine" data-line-num="35"></span>
<span class="code-block-extension-codeLine" data-line-num="36">        <span class="hljs-keyword">await</span> <span class="hljs-string">'执行了一个异步查询'</span></span>
<span class="code-block-extension-codeLine" data-line-num="37">        <span class="hljs-keyword">return</span> students</span>
<span class="code-block-extension-codeLine" data-line-num="38">      }</span>
<span class="code-block-extension-codeLine" data-line-num="39">    },</span>
<span class="code-block-extension-codeLine" data-line-num="40">    <span class="hljs-title class_">Mutation</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="41">        <span class="hljs-attr">addStudent</span>: addStudent,</span>
<span class="code-block-extension-codeLine" data-line-num="42">        <span class="hljs-attr">updateStudent</span>: updateStudent,</span>
<span class="code-block-extension-codeLine" data-line-num="43">        <span class="hljs-attr">deleteStudent</span>: deleteStudent</span>
<span class="code-block-extension-codeLine" data-line-num="44">    }</span>
<span class="code-block-extension-codeLine" data-line-num="45">};</span>
<span class="code-block-extension-codeLine" data-line-num="46"></span>
</code></pre>
<p>和 query 部分差不多，只不过这里实现的是增删改。</p>
<p>我只对 addStudent 做了实现。</p>
<p>我们测试下：</p>
<p>执行 addStudent，添加一个学生：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ccd06869e4ad41d089fa746b37868c23~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后再次查询所有的学生：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14e66d3982aa44789cc022c3fb47c38e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>就可以查到刚来的小刚同学。</p>
<p>这样，我们就可以在一个 graphql 的 POST 接口里完成所有的 CRUD！</p>
<p>全部代码如下，大家可以跑一跑（注意要在 package.json 里加个 type: "module"）</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApolloServer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@apollo/server'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-keyword">import</span> { startStandaloneServer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@apollo/server/standalone'</span> </span>
<span class="code-block-extension-codeLine" data-line-num="3"></span>
<span class="code-block-extension-codeLine" data-line-num="4"><span class="hljs-keyword">const</span> typeDefs = <span class="hljs-string">`</span></span>
<span class="code-block-extension-codeLine" data-line-num="5">  type Student {</span>
<span class="code-block-extension-codeLine" data-line-num="6">    id: String,</span>
<span class="code-block-extension-codeLine" data-line-num="7">    name: String,</span>
<span class="code-block-extension-codeLine" data-line-num="8">    sex: Boolean</span>
<span class="code-block-extension-codeLine" data-line-num="9">    age: Int</span>
<span class="code-block-extension-codeLine" data-line-num="10">  }</span>
<span class="code-block-extension-codeLine" data-line-num="11"></span>
<span class="code-block-extension-codeLine" data-line-num="12">  type Teacher {</span>
<span class="code-block-extension-codeLine" data-line-num="13">    id: String,</span>
<span class="code-block-extension-codeLine" data-line-num="14">    name: String,</span>
<span class="code-block-extension-codeLine" data-line-num="15">    age: Int,</span>
<span class="code-block-extension-codeLine" data-line-num="16">    subject: [String],</span>
<span class="code-block-extension-codeLine" data-line-num="17">    students: [Student]</span>
<span class="code-block-extension-codeLine" data-line-num="18">  }</span>
<span class="code-block-extension-codeLine" data-line-num="19"></span>
<span class="code-block-extension-codeLine" data-line-num="20">  type Query {</span>
<span class="code-block-extension-codeLine" data-line-num="21">    students: [Student],</span>
<span class="code-block-extension-codeLine" data-line-num="22">    teachers: [Teacher],</span>
<span class="code-block-extension-codeLine" data-line-num="23">    studentsbyTeacherName(name: String!): [Student]</span>
<span class="code-block-extension-codeLine" data-line-num="24">  }</span>
<span class="code-block-extension-codeLine" data-line-num="25"></span>
<span class="code-block-extension-codeLine" data-line-num="26">  type Res {</span>
<span class="code-block-extension-codeLine" data-line-num="27">    success: Boolean</span>
<span class="code-block-extension-codeLine" data-line-num="28">    id: String</span>
<span class="code-block-extension-codeLine" data-line-num="29">  }</span>
<span class="code-block-extension-codeLine" data-line-num="30"></span>
<span class="code-block-extension-codeLine" data-line-num="31">  type Mutation {</span>
<span class="code-block-extension-codeLine" data-line-num="32">    addStudent(name:String! age:Int! sex:Boolean!): Res</span>
<span class="code-block-extension-codeLine" data-line-num="33"></span>
<span class="code-block-extension-codeLine" data-line-num="34">    updateStudent(id: String! name:String! age:Int! sex:Boolean!): Res</span>
<span class="code-block-extension-codeLine" data-line-num="35"></span>
<span class="code-block-extension-codeLine" data-line-num="36">    deleteStudent(id: String!): Res</span>
<span class="code-block-extension-codeLine" data-line-num="37">  }</span>
<span class="code-block-extension-codeLine" data-line-num="38"></span>
<span class="code-block-extension-codeLine" data-line-num="39">  schema {</span>
<span class="code-block-extension-codeLine" data-line-num="40">    mutation: Mutation</span>
<span class="code-block-extension-codeLine" data-line-num="41">    query: Query</span>
<span class="code-block-extension-codeLine" data-line-num="42">  }</span>
<span class="code-block-extension-codeLine" data-line-num="43">`;</span>
<span class="code-block-extension-codeLine" data-line-num="44"></span>
<span class="code-block-extension-codeLine" data-line-num="45"><span class="hljs-keyword">const</span> students = [</span>
<span class="code-block-extension-codeLine" data-line-num="46">    {</span>
<span class="code-block-extension-codeLine" data-line-num="47">      <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="48">      <span class="hljs-attr">name</span>: <span class="hljs-keyword">async</span> () =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="49">        <span class="hljs-keyword">await</span> <span class="hljs-string">'取数据'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="50">        <span class="hljs-keyword">return</span> <span class="hljs-string">'光光'</span></span>
<span class="code-block-extension-codeLine" data-line-num="51">      },</span>
<span class="code-block-extension-codeLine" data-line-num="52">      <span class="hljs-attr">sex</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="53">      <span class="hljs-attr">age</span>: <span class="hljs-number">12</span></span>
<span class="code-block-extension-codeLine" data-line-num="54">    },</span>
<span class="code-block-extension-codeLine" data-line-num="55">    {</span>
<span class="code-block-extension-codeLine" data-line-num="56">      <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="57">      <span class="hljs-attr">name</span>:<span class="hljs-string">'东东'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="58">      <span class="hljs-attr">sex</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="59">      <span class="hljs-attr">age</span>: <span class="hljs-number">13</span></span>
<span class="code-block-extension-codeLine" data-line-num="60">    },</span>
<span class="code-block-extension-codeLine" data-line-num="61">    {</span>
<span class="code-block-extension-codeLine" data-line-num="62">      <span class="hljs-attr">id</span>: <span class="hljs-string">'3'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="63">      <span class="hljs-attr">name</span>:<span class="hljs-string">'小红'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="64">      <span class="hljs-attr">sex</span>: <span class="hljs-literal">false</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="65">      <span class="hljs-attr">age</span>: <span class="hljs-number">11</span></span>
<span class="code-block-extension-codeLine" data-line-num="66">    },</span>
<span class="code-block-extension-codeLine" data-line-num="67">];</span>
<span class="code-block-extension-codeLine" data-line-num="68"></span>
<span class="code-block-extension-codeLine" data-line-num="69"><span class="hljs-keyword">const</span> teachers = [</span>
<span class="code-block-extension-codeLine" data-line-num="70">  {</span>
<span class="code-block-extension-codeLine" data-line-num="71">    <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="72">    <span class="hljs-attr">name</span>: <span class="hljs-string">'神光'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="73">    <span class="hljs-attr">sex</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="74">    <span class="hljs-attr">subject</span>: [<span class="hljs-string">'体育'</span>, <span class="hljs-string">'数学'</span>],</span>
<span class="code-block-extension-codeLine" data-line-num="75">    <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="76">    <span class="hljs-attr">students</span>: students</span>
<span class="code-block-extension-codeLine" data-line-num="77">  }</span>
<span class="code-block-extension-codeLine" data-line-num="78">]</span>
<span class="code-block-extension-codeLine" data-line-num="79"></span>
<span class="code-block-extension-codeLine" data-line-num="80"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addStudent</span> (_, { name, age, sex }) {</span>
<span class="code-block-extension-codeLine" data-line-num="81">    students.<span class="hljs-title function_">push</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="82">        <span class="hljs-attr">id</span>: <span class="hljs-string">'一个随机 id'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="83">        name,</span>
<span class="code-block-extension-codeLine" data-line-num="84">        age,</span>
<span class="code-block-extension-codeLine" data-line-num="85">        sex</span>
<span class="code-block-extension-codeLine" data-line-num="86">    });</span>
<span class="code-block-extension-codeLine" data-line-num="87">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="88">      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="89">      <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span></span>
<span class="code-block-extension-codeLine" data-line-num="90">    }</span>
<span class="code-block-extension-codeLine" data-line-num="91">}</span>
<span class="code-block-extension-codeLine" data-line-num="92"></span>
<span class="code-block-extension-codeLine" data-line-num="93"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStudent</span> (_, { id, name, age, sex }) {</span>
<span class="code-block-extension-codeLine" data-line-num="94"></span>
<span class="code-block-extension-codeLine" data-line-num="95">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="96">      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="97">      <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span></span>
<span class="code-block-extension-codeLine" data-line-num="98">    }</span>
<span class="code-block-extension-codeLine" data-line-num="99">}</span>
<span class="code-block-extension-codeLine" data-line-num="100"></span>
<span class="code-block-extension-codeLine" data-line-num="101"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteStudent</span> (_, { id }) {</span>
<span class="code-block-extension-codeLine" data-line-num="102">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="103">      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="104">      <span class="hljs-attr">id</span>: <span class="hljs-string">'xxx'</span></span>
<span class="code-block-extension-codeLine" data-line-num="105">    }</span>
<span class="code-block-extension-codeLine" data-line-num="106">}</span>
<span class="code-block-extension-codeLine" data-line-num="107">  </span>
<span class="code-block-extension-codeLine" data-line-num="108"><span class="hljs-keyword">const</span> resolvers = {</span>
<span class="code-block-extension-codeLine" data-line-num="109">    <span class="hljs-title class_">Query</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="110">      <span class="hljs-attr">students</span>: <span class="hljs-function">() =&gt;</span> students,</span>
<span class="code-block-extension-codeLine" data-line-num="111">      <span class="hljs-attr">teachers</span>: <span class="hljs-function">() =&gt;</span> teachers,</span>
<span class="code-block-extension-codeLine" data-line-num="112">      <span class="hljs-attr">studentsbyTeacherName</span>: <span class="hljs-keyword">async</span> (...args) =&gt; {</span>
<span class="code-block-extension-codeLine" data-line-num="113">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(args);</span>
<span class="code-block-extension-codeLine" data-line-num="114"></span>
<span class="code-block-extension-codeLine" data-line-num="115">        <span class="hljs-keyword">await</span> <span class="hljs-string">'执行了一个异步查询'</span></span>
<span class="code-block-extension-codeLine" data-line-num="116">        <span class="hljs-keyword">return</span> students</span>
<span class="code-block-extension-codeLine" data-line-num="117">      }</span>
<span class="code-block-extension-codeLine" data-line-num="118">    },</span>
<span class="code-block-extension-codeLine" data-line-num="119">    <span class="hljs-title class_">Mutation</span>: {</span>
<span class="code-block-extension-codeLine" data-line-num="120">        <span class="hljs-attr">addStudent</span>: addStudent,</span>
<span class="code-block-extension-codeLine" data-line-num="121">        <span class="hljs-attr">updateStudent</span>: updateStudent,</span>
<span class="code-block-extension-codeLine" data-line-num="122">        <span class="hljs-attr">deleteStudent</span>: deleteStudent</span>
<span class="code-block-extension-codeLine" data-line-num="123">    }</span>
<span class="code-block-extension-codeLine" data-line-num="124">};</span>
<span class="code-block-extension-codeLine" data-line-num="125"></span>
<span class="code-block-extension-codeLine" data-line-num="126"><span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloServer</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="127">    typeDefs,</span>
<span class="code-block-extension-codeLine" data-line-num="128">    resolvers,</span>
<span class="code-block-extension-codeLine" data-line-num="129">});</span>
<span class="code-block-extension-codeLine" data-line-num="130">  </span>
<span class="code-block-extension-codeLine" data-line-num="131"><span class="hljs-keyword">const</span> { url } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">startStandaloneServer</span>(server, {</span>
<span class="code-block-extension-codeLine" data-line-num="132">    <span class="hljs-attr">listen</span>: { <span class="hljs-attr">port</span>: <span class="hljs-number">4000</span> },</span>
<span class="code-block-extension-codeLine" data-line-num="133">});</span>
<span class="code-block-extension-codeLine" data-line-num="134">  </span>
<span class="code-block-extension-codeLine" data-line-num="135"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🚀  Server ready at: <span class="hljs-subst">${url}</span>`</span>);</span>
</code></pre>
<p>完成了 graphql 的入门，我们再稍微思考下它的原理。graphql 是怎么实现的呢？</p>
<p>回顾整个流程，我们发现涉及到两种 DSL（领域特定语言），一个是 schema 定义的 DSL，一个是查询的 DSL。</p>
<p>服务端通过 schema 定义的 DSL 来声明 graph 图，通过 resolver 来接受参数，执行查询和增删改。</p>
<p>客户端通过查询的 DSL 来定义如何查询和如何增删改，再发给服务端来解析执行。</p>
<p>通过这种 DSL 实现了动态的查询。</p>
<p>确实很方便很灵活，但也有缺点，就是 parse DSL 为 AST 性能肯定是不如 restful 那种直接执行增删改查高的。</p>
<p>具体要不要用 graphql 还是要根据具体场景来做判断。</p>
<p>案例代码在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuarkGluonPlasma%2Fnestjs-course-code%2Ftree%2Fmain%2Fgraphql-crud-demo" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/graphql-crud-demo" ref="nofollow noopener noreferrer">小册仓库</a>。</p>
<h2 data-id="heading-0">总结</h2>
<p>restful 接口是 url 代表资源，GET、POST、PUT、DELETE 请求代表对资源的增删改查。</p>
<p>这种接口返回什么数据完全由服务端决定，每次接口变动可能就得新加一种接口。</p>
<p>为了解决这种问题，facebook 创造了 graphql，这种接口返回什么数据完全由客户端决定。增删改查通过这一个接口就可以搞定。</p>
<p>graphql 需要在服务端定义 schema，也就是定义对象类型和它的字段，对象类型和对象类型之间会有关联，也就是一个 graph，查询就是从这个 graph 里查询数据。</p>
<p>除了 schema 外，还需要有 resolver，它负责接受客户端的参数，完成具体数据的增删改查。</p>
<p>graphql 会暴露一个 post 接口，通过查询语言的语法就可以从通过这个接口完成所有增删改查。</p>
<p>本地测试的时候，get 请求会跑一个 sandbox，可以在这里测试接口。</p>
<p>整个流程涉及到两种新语言： schema 定义语言和 query 查询语言。入门之后向深入的话就是要学下这两种 DSL 的更多语法。</p>
<p>感受到 graphql 的强大之处了么？一个接口就可以实现所有的 CRUD！</p></div>