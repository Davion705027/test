<header>
        <style>
            .markdown-body{
                width: 80%;
                margin: auto;
            }
            .code-block-extension-header{
                display: none;
            }
        </style>
    </header><div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre>code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>后端开发完接口后，需要给前端一份接口文档，描述有哪些接口，是 GET 还是 POST，有哪些参数，响应是什么。</p>
<p>但是写完代码后再去单独写一份这样的文档还是很麻烦的，并且改动接口之后也要同步去修改接口文档。</p>
<p>能不能自动生成 API 接口文档呢？</p>
<p>是可以的，就是这节要讲的 swagger。</p>
<p>我们新建个项目：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">arduino</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-arduino code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">nest <span class="hljs-keyword">new</span> swagger-test -p npm</span>
</code></pre>
<p>安装 swagger 的包：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">css</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-css code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm install <span class="hljs-attr">--save</span> <span class="hljs-keyword">@nestjs</span>/swagger</span>
</code></pre>
<p>然后在 main.ts 添加这样一段代码：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c645be06c5b4a17b5559a461ab31592~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentBuilder</span>()</span>
<span class="code-block-extension-codeLine" data-line-num="2">    .<span class="hljs-title function_">setTitle</span>(<span class="hljs-string">'Test example'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="3">    .<span class="hljs-title function_">setDescription</span>(<span class="hljs-string">'The API description'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="4">    .<span class="hljs-title function_">setVersion</span>(<span class="hljs-string">'1.0'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="5">    .<span class="hljs-title function_">addTag</span>(<span class="hljs-string">'test'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="6">    .<span class="hljs-title function_">build</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="7"><span class="hljs-keyword">const</span> <span class="hljs-variable language_">document</span> = <span class="hljs-title class_">SwaggerModule</span>.<span class="hljs-title function_">createDocument</span>(app, config);</span>
<span class="code-block-extension-codeLine" data-line-num="8"><span class="hljs-title class_">SwaggerModule</span>.<span class="hljs-title function_">setup</span>(<span class="hljs-string">'doc'</span>, app, <span class="hljs-variable language_">document</span>);</span>
</code></pre>
<p>通过 DocumentBuilder 创建 config。</p>
<p>然后用 SwaggerModule.createDocument 根据 config 创建文档。</p>
<p>之后用 SwaggerModule.setup 指定在哪个路径可以访问文档。</p>
<p>跑起来试试：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">arduino</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-arduino code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">npm run start:dev</span>
</code></pre>
<p>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2Fdoc" target="_blank" rel="nofollow noopener noreferrer" title="http://localhost:3000/doc" ref="nofollow noopener noreferrer">http://localhost:3000/doc</a> 就可以看到 swagger 的 api 文档了：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8b17204d5704ab6ad958322794bb88d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>和 DocumentBuilder 填的配置的对应关系如下：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/945dc014c5984efb9736936dc06507b8~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>现在只有一个接口，调用会返回 hello world：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/517ff7aef95d45eb808e1de8b20bcf73~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>点击 try it out，再点击 execute，就可以看到返回的响应体和 header：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e13e86f9de74368b7453cabcb54fc95~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>我们在 AppController 加几个接口试试：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">Get</span>(<span class="hljs-string">'aaa'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-title function_">aaa</span>(<span class="hljs-params">@Query(<span class="hljs-string">'a1'</span>) a1, @Query(<span class="hljs-string">'a2'</span>) a2</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a1, a2);</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-keyword">return</span> <span class="hljs-string">'aaa success'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">@<span class="hljs-title class_">Get</span>(<span class="hljs-string">'bbb/:id'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="8"><span class="hljs-title function_">bbb</span>(<span class="hljs-params">@Param(<span class="hljs-string">'id'</span>) id</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(id);</span>
<span class="code-block-extension-codeLine" data-line-num="10">    <span class="hljs-keyword">return</span> <span class="hljs-string">'bbb success'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
<span class="code-block-extension-codeLine" data-line-num="12"></span>
<span class="code-block-extension-codeLine" data-line-num="13">@<span class="hljs-title class_">Post</span>(<span class="hljs-string">'ccc'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="14"><span class="hljs-title function_">ccc</span>(<span class="hljs-params">@Body(<span class="hljs-string">'ccc'</span>) ccc</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="15">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ccc);</span>
<span class="code-block-extension-codeLine" data-line-num="16">    <span class="hljs-keyword">return</span> <span class="hljs-string">'ccc success'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="17">}</span>
</code></pre>
<p>加了一个有 query 参数、一个有 param 参数、一个有 body 参数的接口。</p>
<p>刷新下可以看到，这几个接口都列出来了：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cfd5095e658f45e68550100fb4ac439d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>但是都没有 param 的描述和 response 的描述：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92a96da2278c45c5a9fb83dad8e8ad9c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这时就需要我们手动标注了：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">ApiOperation</span>({ <span class="hljs-attr">summary</span>: <span class="hljs-string">'测试 aaa'</span>,<span class="hljs-attr">description</span>: <span class="hljs-string">'aaa 描述'</span> })</span>
<span class="code-block-extension-codeLine" data-line-num="2">@<span class="hljs-title class_">ApiResponse</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">status</span>: <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">description</span>: <span class="hljs-string">'aaa 成功'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">})</span>
<span class="code-block-extension-codeLine" data-line-num="7">@<span class="hljs-title class_">Get</span>(<span class="hljs-string">'aaa'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="8"><span class="hljs-title function_">aaa</span>(<span class="hljs-params">@Query(<span class="hljs-string">'a1'</span>) a1, @Query(<span class="hljs-string">'a2'</span>) a2</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a1, a2);</span>
<span class="code-block-extension-codeLine" data-line-num="10">    <span class="hljs-keyword">return</span> <span class="hljs-string">'aaa success'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="11">}</span>
</code></pre>
<p>给 aaa 接口添加 @ApiOperation 和 @ApiResponse 的装饰器。</p>
<p>这俩分别是指定这个接口的描述，接口的响应的。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc02071eead047c9a037c29fa5d197a0~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>再加上 @ApiQuery 来添加 query 参数的说明：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddab64ec2ad04c35a54f79245f26786d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">ApiQuery</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-attr">name</span>: <span class="hljs-string">'a1'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">description</span>: <span class="hljs-string">'a1 param'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="6">    <span class="hljs-attr">example</span>: <span class="hljs-string">'1111'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="7">})</span>
<span class="code-block-extension-codeLine" data-line-num="8">@<span class="hljs-title class_">ApiQuery</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-attr">name</span>: <span class="hljs-string">'a2'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="10">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="11">    <span class="hljs-attr">description</span>: <span class="hljs-string">'a2 param'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="12">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="13">    <span class="hljs-attr">example</span>: <span class="hljs-number">2222</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="14">})  </span>
</code></pre>
<p>刷新下，可以看到 swagger 文档里出现了这两个参数的说明：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0be733a2a8eb4701b4dcc4f7b4dcbf4e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>点击 try it out 和 execute，就可以看到发送了请求并返回了响应：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05da071c7fcb46b9a3da7a347735529c~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这样，一个接口就描述完了：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5427ccb8ee86457ea1059b164eff0b30~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>通过 @ApiOperation 描述接口的信息，@ApiResponse 描述返回值信息，@ApiQuery 描述 query 参数信息。</p>
<p>就能生成对应的 swagger 文档：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4360aa09d0a446d2bfa7039ea93a2f82~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>我们接着来生成 bbb 接口的 swagger 文档：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea2eee5a5bc846a18f17590b9e88fbfe~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这里用到的是 @ApiParam 而不是 @ApiQuery，其余部分一样：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">ApiOperation</span>({ <span class="hljs-attr">summary</span>: <span class="hljs-string">'测试 bbb'</span>,<span class="hljs-attr">description</span>: <span class="hljs-string">'bbb 描述'</span> })</span>
<span class="code-block-extension-codeLine" data-line-num="2">@<span class="hljs-title class_">ApiResponse</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">status</span>: <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">description</span>: <span class="hljs-string">'bbb 成功'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">})</span>
<span class="code-block-extension-codeLine" data-line-num="7">@<span class="hljs-title class_">ApiParam</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">name</span>: <span class="hljs-string">'id'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-attr">description</span>: <span class="hljs-string">'ID'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="10">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="11">    <span class="hljs-attr">example</span>: <span class="hljs-number">222</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="12">})</span>
</code></pre>
<p>刷新可以看到 bbb 接口的文档：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/928e4e0819c64c60a839dc77b203fba8~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>那如果 id 不合法的时候，我返回了一个 401 的响应呢？</p>
<p>那就再加一个 @ApiResponse</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dbebbca1221c4ff1bcb7f07bb0087faa~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">ApiOperation</span>({ <span class="hljs-attr">summary</span>: <span class="hljs-string">'测试 bbb'</span>,<span class="hljs-attr">description</span>: <span class="hljs-string">'bbb 描述'</span> })</span>
<span class="code-block-extension-codeLine" data-line-num="2">@<span class="hljs-title class_">ApiResponse</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">status</span>: <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">description</span>: <span class="hljs-string">'bbb 成功'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">})</span>
<span class="code-block-extension-codeLine" data-line-num="7">@<span class="hljs-title class_">ApiResponse</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">status</span>: <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">UNAUTHORIZED</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="9">    <span class="hljs-attr">description</span>: <span class="hljs-string">'id 不合法'</span></span>
<span class="code-block-extension-codeLine" data-line-num="10">})</span>
<span class="code-block-extension-codeLine" data-line-num="11">@<span class="hljs-title class_">ApiParam</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="12">    <span class="hljs-attr">name</span>: <span class="hljs-string">'id'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="13">    <span class="hljs-attr">description</span>: <span class="hljs-string">'ID'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="14">    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="15">    <span class="hljs-attr">example</span>: <span class="hljs-number">222</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="16">})</span>
<span class="code-block-extension-codeLine" data-line-num="17">@<span class="hljs-title class_">Get</span>(<span class="hljs-string">'bbb/:id'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="18"><span class="hljs-title function_">bbb</span>(<span class="hljs-params">@Param(<span class="hljs-string">'id'</span>) id: number</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="19">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(id);</span>
<span class="code-block-extension-codeLine" data-line-num="20">    <span class="hljs-keyword">if</span>(id !== <span class="hljs-number">111</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="21">      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="22">    }</span>
<span class="code-block-extension-codeLine" data-line-num="23">    <span class="hljs-keyword">return</span> <span class="hljs-string">'bbb success'</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="24">}</span>
</code></pre>
<p>刷新下，可以看到 swagger 文档标识出了这两种响应：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1e6369dab694daeb2afbc546cfa201b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后再来写 ccc 接口的文档：</p>
<p>ccc 接收的是请求体的参数，我们创建个 CccDto。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/185022403c7a4b05bcb40432470b2e50~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CccDto</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-attr">aaa</span>: string;</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">bbb</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">ccc</span>: <span class="hljs-title class_">Array</span>&lt;string&gt;;</span>
<span class="code-block-extension-codeLine" data-line-num="5">}</span>
</code></pre>
<p>接收参数通过 dto 来接收，而返回值放在 vo 里：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">Post</span>(<span class="hljs-string">'ccc'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-title function_">ccc</span>(<span class="hljs-params">@Body(<span class="hljs-string">'ccc'</span>) ccc: CccDto</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ccc);</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-keyword">return</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="5">      <span class="hljs-attr">aaa</span>: <span class="hljs-number">111</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="6">      <span class="hljs-attr">bbb</span>: <span class="hljs-number">222</span></span>
<span class="code-block-extension-codeLine" data-line-num="7">    };</span>
<span class="code-block-extension-codeLine" data-line-num="8">}</span>
</code></pre>
<p>创建个 vo 的 class：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d057b89a9f934284bdc503a5ab75cb63~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CccVo</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="2">    <span class="hljs-attr">aaa</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">bbb</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="4">}</span>
</code></pre>
<p>返回值就可以改成这样了：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">Post</span>(<span class="hljs-string">'ccc'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="2"><span class="hljs-title function_">ccc</span>(<span class="hljs-params">@Body(<span class="hljs-string">'ccc'</span>) ccc: CccDto</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ccc);</span>
<span class="code-block-extension-codeLine" data-line-num="4"></span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-keyword">const</span> vo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CccVo</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="6">    vo.<span class="hljs-property">aaa</span> = <span class="hljs-number">111</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="7">    vo.<span class="hljs-property">bbb</span> = <span class="hljs-number">222</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-keyword">return</span> vo;</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>
<p>这里的 dto、vo 随便搜一下就能查到解释：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b8dc9e339e846f19a8129d2836abd43~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>在 Nest 里要能清楚的区分 dto、vo、entity 的区别：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/edaa8bcb7b60410381818bb437fc9e9e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>dto 是 data transfer object，用于参数的接收。</p>
<p>vo 是 view object，用于返回给视图的数据的封装。</p>
<p>而 entity 是和数据库表对应的实体类。</p>
<p>然后我们继续来写 ccc 接口的 swagger 文档。</p>
<p>很容易想到，body 的描述是通过 @ApiBody 的装饰器：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39542f0b140443f185e16d6284e94628~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1">@<span class="hljs-title class_">ApiOperation</span>({<span class="hljs-attr">summary</span>:<span class="hljs-string">'测试 ccc'</span>})</span>
<span class="code-block-extension-codeLine" data-line-num="2">@<span class="hljs-title class_">ApiResponse</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="3">    <span class="hljs-attr">status</span>: <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="4">    <span class="hljs-attr">description</span>: <span class="hljs-string">'ccc 成功'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">CccVo</span></span>
<span class="code-block-extension-codeLine" data-line-num="6">})</span>
<span class="code-block-extension-codeLine" data-line-num="7">@<span class="hljs-title class_">ApiBody</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">CccDto</span></span>
<span class="code-block-extension-codeLine" data-line-num="9">})</span>
<span class="code-block-extension-codeLine" data-line-num="10">@<span class="hljs-title class_">Post</span>(<span class="hljs-string">'ccc'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="11"><span class="hljs-title function_">ccc</span>(<span class="hljs-params">@Body(<span class="hljs-string">'ccc'</span>) ccc: CccDto</span>) {</span>
<span class="code-block-extension-codeLine" data-line-num="12">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ccc);</span>
<span class="code-block-extension-codeLine" data-line-num="13"></span>
<span class="code-block-extension-codeLine" data-line-num="14">    <span class="hljs-keyword">const</span> vo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CccVo</span>();</span>
<span class="code-block-extension-codeLine" data-line-num="15">    vo.<span class="hljs-property">aaa</span> = <span class="hljs-number">111</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="16">    vo.<span class="hljs-property">bbb</span> = <span class="hljs-number">222</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="17">    <span class="hljs-keyword">return</span> vo;</span>
<span class="code-block-extension-codeLine" data-line-num="18">}</span>
</code></pre>
<p>刷新页面，你会看到除了接口外，还生成了俩 schema。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d78231587744afbacb85f8c3c7fc3e9~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>也就是说对象的响应会对应 swagger 的 schema。</p>
<p>只不过现在 CccDto、CccVo 的 schema 没有内容，这是因为我们还没有标注。</p>
<p>在 CccDto 加一下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abb3e22b2a6447c8a5232f2a7e57c1cb~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>aaa、bbb、ccc 通过 @ApiProperty 标识下，并且 bbb 是 @ApiPropertyOptional，也就是可选，这个和 @ApiProperty({ required: false }) 等价。</p>
<p>aaa 可以传 enum 的值，取值范围是 a1、a2、a3。</p>
<p>同样，CccVo 也加一下：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiProperty</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@nestjs/swagger"</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CccVo</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    @<span class="hljs-title class_">ApiProperty</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'aaa'</span> })</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">aaa</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">    @<span class="hljs-title class_">ApiProperty</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'bbb'</span> })</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">bbb</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="9">}</span>
</code></pre>
<p>刷新下，现在就可以看到 CccDto、CccVo 的 schema 有属性了：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/433d58322cd84bbf964323d28a4e7b74~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>其中 bbb 是没有 * 的，代表可不传。</p>
<p>上面的接口部分也有了请求和响应的示例：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cee6fce3f6d34449a210dbf71fe613f0~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>点下 try it out，可以自己编辑请求体：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f08047115ad04ef9a5f8fabeec948dfa~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后点击 execute 就可以看到响应的内容和 header：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d831fe310e9a41128c3c5f6e01bdbd24~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>服务端也确实接收到了这个请求：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89aa180b109e45688f5db458e6188dc9~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>可以用 swagger 来方便的测试接口。</p>
<p>此外，还可以通过 @ApiTags 来给接口分组：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d963555e47bc4ac7979999931a7bfeea~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>比如 controller 是 xxx 开头的，那可以用 @ApiTags 来分组到 xxx。</p>
<p>显示的时候，就会把这个 controller 的接口分到一个组下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4d6cc0150aa4f8d962ea13af2eec87f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>也可以添加在 handler 上：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1c1e08988874b2d912f7cf5f48fb4b6~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c16f33a37034a33b31c882438507b38~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>比如把 aaa、bbb 接口分到 xxx-get 的组。</p>
<p>那显示的时候就会把这俩接口分出来：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/901666caeb6240dc88e1ab6cd0777bc4~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>当接口多了之后，分组还是很有必要的。</p>
<p>回过头来，再讲下 @ApiProperty，其实它还有很多属性：</p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiProperty</span>, <span class="hljs-title class_">ApiPropertyOptional</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@nestjs/swagger"</span>;</span>
<span class="code-block-extension-codeLine" data-line-num="2"></span>
<span class="code-block-extension-codeLine" data-line-num="3"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CccDto</span> {</span>
<span class="code-block-extension-codeLine" data-line-num="4">    @<span class="hljs-title class_">ApiProperty</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'aaa'</span>, <span class="hljs-attr">enum</span>: [<span class="hljs-string">'a1'</span>, <span class="hljs-string">'a2'</span>, <span class="hljs-string">'a3'</span>], <span class="hljs-attr">maxLength</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">minLength</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>})</span>
<span class="code-block-extension-codeLine" data-line-num="5">    <span class="hljs-attr">aaa</span>: string;</span>
<span class="code-block-extension-codeLine" data-line-num="6"></span>
<span class="code-block-extension-codeLine" data-line-num="7">    @<span class="hljs-title class_">ApiPropertyOptional</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'bbb'</span>, <span class="hljs-attr">maximum</span>: <span class="hljs-number">60</span>, <span class="hljs-attr">minimum</span>: <span class="hljs-number">40</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">example</span>: <span class="hljs-number">55</span>})</span>
<span class="code-block-extension-codeLine" data-line-num="8">    <span class="hljs-attr">bbb</span>: number;</span>
<span class="code-block-extension-codeLine" data-line-num="9"></span>
<span class="code-block-extension-codeLine" data-line-num="10">    @<span class="hljs-title class_">ApiProperty</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'ccc'</span> })</span>
<span class="code-block-extension-codeLine" data-line-num="11">    <span class="hljs-attr">ccc</span>: <span class="hljs-title class_">Array</span>&lt;string&gt;;</span>
<span class="code-block-extension-codeLine" data-line-num="12">}</span>
</code></pre>
<p>比如 required、minium、maximum、default、maxLength 等。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94fb118bab6d4056acce8341bedcddb0~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>此外，很多接口是需要登录才能访问的，那如何限制呢？</p>
<p>swagger 也提供了这方面的支持。</p>
<p>常用的认证方式就是 jwt、cookie。</p>
<p>分别在 aaa、bbb、ccc 接口添加 @ApiBearerAuth、@ApiCookieAuth、@ApiBasicAuth</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ea1c748586649e19a7a9c20b3c8980e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c475ca8e76c24cb68986e4197acd116e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60c028ddc2514f12b15fa9832da658ac~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>然后在 main.ts 里添 3 种认证方式的信息：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9db844dbb883482fbfb72c689db9e220~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<pre><div class="code-block-extension-header" style="background-color: rgb(248, 248, 248);"><div class="code-block-extension-headerLeft"><div class="code-block-extension-foldBtn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.924 9.617A1 1 0 0 0 16 9H8a1 1 0 0 0-.707 1.707l4 4a1 1 0 0 0 1.414 0l4-4a1 1 0 0 0 .217-1.09z" data-name="Down"></path></svg></div></div><div class="code-block-extension-headerRight"><span class="code-block-extension-lang">javascript</span><div class="code-block-extension-copyCodeBtn">复制代码</div></div></div><code class="hljs language-javascript code-block-extension-codeShowNum"><span class="code-block-extension-codeLine" data-line-num="1"><span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentBuilder</span>()</span>
<span class="code-block-extension-codeLine" data-line-num="2">    .<span class="hljs-title function_">setTitle</span>(<span class="hljs-string">'Test example'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="3">    .<span class="hljs-title function_">setDescription</span>(<span class="hljs-string">'The API description'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="4">    .<span class="hljs-title function_">setVersion</span>(<span class="hljs-string">'1.0'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="5">    .<span class="hljs-title function_">addTag</span>(<span class="hljs-string">'test'</span>)</span>
<span class="code-block-extension-codeLine" data-line-num="6">    .<span class="hljs-title function_">addBasicAuth</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="7">      <span class="hljs-attr">type</span>: <span class="hljs-string">'http'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="8">      <span class="hljs-attr">name</span>: <span class="hljs-string">'basic'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="9">      <span class="hljs-attr">description</span>: <span class="hljs-string">'用户名 + 密码'</span></span>
<span class="code-block-extension-codeLine" data-line-num="10">    })</span>
<span class="code-block-extension-codeLine" data-line-num="11">    .<span class="hljs-title function_">addCookieAuth</span>(<span class="hljs-string">'sid'</span>, {</span>
<span class="code-block-extension-codeLine" data-line-num="12">      <span class="hljs-attr">type</span>: <span class="hljs-string">'apiKey'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="13">      <span class="hljs-attr">name</span>: <span class="hljs-string">'cookie'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="14">      <span class="hljs-attr">description</span>: <span class="hljs-string">'基于 cookie 的认证'</span></span>
<span class="code-block-extension-codeLine" data-line-num="15">    })</span>
<span class="code-block-extension-codeLine" data-line-num="16">    .<span class="hljs-title function_">addBearerAuth</span>({</span>
<span class="code-block-extension-codeLine" data-line-num="17">      <span class="hljs-attr">type</span>: <span class="hljs-string">'http'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="18">      <span class="hljs-attr">description</span>: <span class="hljs-string">'基于 jwt 的认证'</span>,</span>
<span class="code-block-extension-codeLine" data-line-num="19">      <span class="hljs-attr">name</span>: <span class="hljs-string">'bearer'</span></span>
<span class="code-block-extension-codeLine" data-line-num="20">    })</span>
<span class="code-block-extension-codeLine" data-line-num="21">    .<span class="hljs-title function_">build</span>();</span>
</code></pre>
<p>刷新页面就可以看到接口出现了锁的标记：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23266a80d42f4459b1255df4979a082f~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>点击 aaa 的锁：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e0b0c78006746bbb39176d04e4eba17~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>输入 jwt 的 token，然后点击 authorize。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f55b2d227d3f4cb49383a04acae8641b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>锁会变成锁住状态，代表授权成功了。</p>
<p>这时候再发一个请求：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5caf31dfd8264d99ab167ee86cb7b41d~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>会发现带上了 Authorization 的 header，这就是我们见过的 jwt 认证方式。</p>
<p>同理，下面的 cookie 会带上对应的 cookie来认证：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c021aa0737dc4b3f92329c9fb21feaaa~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da5b7aec500e4165804e0101c1c0e80e~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>而 basic 的方式，会要求你输入用户名密码：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09aa9509541f48208dd4a29dfc6c94f3~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>请求时会带上 Authorization： Basic xxx 的 header 来访问。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d43a6425294432fa742256fd7fae12b~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>这样，这些需要授权的接口就分别添加上了不同的认证方式的标识。</p>
<p>其实，swagger 是一种叫做 openapi 标准的实现。</p>
<p>在 /doc 后加上个 -json 就可以看到对应的 json</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a05e60ef45b440fbf084e33eff22f05~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>装个格式化 chrome 插件格式化一下，大概是这样的：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0da0580723d04a35899855cc57e892d6~tplv-k3u1fbpfcp-jj-mark:1663:0:0:0:q75.awebp" alt="" loading="lazy" class="medium-zoom-image"></p>
<p>如果你觉得 swagger 文档比较丑，可以这个 json 导入别的平台。</p>
<p>一般 api 接口的平台都是支持 openapi 的。</p>
<p>案例代码在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQuarkGluonPlasma%2Fnestjs-course-code%2Ftree%2Fmain%2Fswagger-test" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/swagger-test" ref="nofollow noopener noreferrer">小册仓库</a></p>
<h2 data-id="heading-0">总结</h2>
<p>这节我们学习了 swagger 自动生成文档。</p>
<p>需要先安装 @nestjs/swagger 的包。</p>
<p>然后在 main.ts 里用 DocumentBuilder + SwaggerModule.createDocuemnt 创建 swagger 文档配置，然后 setup 跑起来就好了。</p>
<p>还需要手动加一些装饰器来标注：</p>
<ul>
<li>ApiOperation：声明接口信息</li>
<li>ApiResponse：声明响应信息，一个接口可以多种响应</li>
<li>ApiQuery：声明 query 参数信息</li>
<li>ApiParam：声明 param 参数信息</li>
<li>ApiBody：声明 body 参数信息，可以省略</li>
<li>ApiProperty：声明 dto、vo 的属性信息</li>
<li>ApiPropertyOptional：声明 dto、vo 的属性信息，相当于 required: false 的 ApiProperty</li>
<li>ApiTags：对接口进行分组</li>
<li>ApiBearerAuth：通过 jwt 的方式认证，也就是 Authorization: Bearer xxx</li>
<li>ApiCookieAuth：通过 cookie 的方式认证</li>
<li>ApiBasicAuth：通过用户名、密码认证，在 header 添加 Authorization: Basic xxx</li>
</ul>
<p>swagger 是 openapi 标准的实现，可以在 url 后加个 -json 拿到对应的 json，然后导入别的接口文档平台来用。</p>
<p>绝大多数公司的接口文档都是用 swagger 来自动生成的，不然手动维护太麻烦了。</p>
<p>而且 swagger 还可以方便的测试接口，自动添加身份认证等。</p>
<p>你们公司用的是 swagger 生成的接口文档么？</p></div>